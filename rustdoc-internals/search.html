<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Search - Rust Compiler Development Guide</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A guide to developing the Rust compiler (rustc)">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../getting-started.html">Getting Started</a></li><li class="chapter-item affix "><a href="../about-this-guide.html">About this guide</a></li><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Building and debugging rustc</li><li class="chapter-item "><a href="../building/how-to-build-and-run.html"><strong aria-hidden="true">1.</strong> How to build and run the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../building/quickstart.html"><strong aria-hidden="true">1.1.</strong> Quickstart</a></li><li class="chapter-item "><a href="../building/prerequisites.html"><strong aria-hidden="true">1.2.</strong> Prerequisites</a></li><li class="chapter-item "><a href="../building/suggested.html"><strong aria-hidden="true">1.3.</strong> Suggested Workflows</a></li><li class="chapter-item "><a href="../building/build-install-distribution-artifacts.html"><strong aria-hidden="true">1.4.</strong> Distribution artifacts</a></li><li class="chapter-item "><a href="../building/compiler-documenting.html"><strong aria-hidden="true">1.5.</strong> Building Documentation</a></li><li class="chapter-item "><a href="../rustdoc.html"><strong aria-hidden="true">1.6.</strong> Rustdoc overview</a></li><li class="chapter-item "><a href="../building/new-target.html"><strong aria-hidden="true">1.7.</strong> Adding a new target</a></li><li class="chapter-item "><a href="../building/optimized-build.html"><strong aria-hidden="true">1.8.</strong> Optimized build</a></li></ol></li><li class="chapter-item "><a href="../tests/intro.html"><strong aria-hidden="true">2.</strong> Testing the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/running.html"><strong aria-hidden="true">2.1.</strong> Running tests</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/docker.html"><strong aria-hidden="true">2.1.1.</strong> Testing with Docker</a></li><li class="chapter-item "><a href="../tests/ci.html"><strong aria-hidden="true">2.1.2.</strong> Testing with CI</a></li></ol></li><li class="chapter-item "><a href="../tests/adding.html"><strong aria-hidden="true">2.2.</strong> Adding new tests</a></li><li class="chapter-item "><a href="../tests/best-practices.html"><strong aria-hidden="true">2.3.</strong> Best practices</a></li><li class="chapter-item "><a href="../tests/compiletest.html"><strong aria-hidden="true">2.4.</strong> Compiletest</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/ui.html"><strong aria-hidden="true">2.4.1.</strong> UI tests</a></li><li class="chapter-item "><a href="../tests/directives.html"><strong aria-hidden="true">2.4.2.</strong> Test directives</a></li><li class="chapter-item "><a href="../tests/minicore.html"><strong aria-hidden="true">2.4.3.</strong> Minicore</a></li></ol></li><li class="chapter-item "><a href="../tests/ecosystem.html"><strong aria-hidden="true">2.5.</strong> Ecosystem testing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/crater.html"><strong aria-hidden="true">2.5.1.</strong> Crater</a></li><li class="chapter-item "><a href="../tests/ecosystem-test-jobs/fuchsia.html"><strong aria-hidden="true">2.5.2.</strong> Fuchsia</a></li><li class="chapter-item "><a href="../tests/ecosystem-test-jobs/rust-for-linux.html"><strong aria-hidden="true">2.5.3.</strong> Rust for Linux</a></li></ol></li><li class="chapter-item "><a href="../tests/codegen-backend-tests/intro.html"><strong aria-hidden="true">2.6.</strong> Codegen backend testing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/codegen-backend-tests/cg_clif.html"><strong aria-hidden="true">2.6.1.</strong> Cranelift codegen backend</a></li><li class="chapter-item "><a href="../tests/codegen-backend-tests/cg_gcc.html"><strong aria-hidden="true">2.6.2.</strong> GCC codegen backend</a></li></ol></li><li class="chapter-item "><a href="../tests/perf.html"><strong aria-hidden="true">2.7.</strong> Performance testing</a></li><li class="chapter-item "><a href="../tests/suggest-tests.html"><strong aria-hidden="true">2.8.</strong> Suggest tests tool</a></li><li class="chapter-item "><a href="../tests/misc.html"><strong aria-hidden="true">2.9.</strong> Misc info</a></li></ol></li><li class="chapter-item "><a href="../compiler-debugging.html"><strong aria-hidden="true">3.</strong> Debugging the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tracing.html"><strong aria-hidden="true">3.1.</strong> Using the tracing/logging instrumentation</a></li></ol></li><li class="chapter-item "><a href="../profiling.html"><strong aria-hidden="true">4.</strong> Profiling the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../profiling/with_perf.html"><strong aria-hidden="true">4.1.</strong> with the linux perf tool</a></li><li class="chapter-item "><a href="../profiling/wpa_profiling.html"><strong aria-hidden="true">4.2.</strong> with Windows Performance Analyzer</a></li><li class="chapter-item "><a href="../profiling/with_rustc_perf.html"><strong aria-hidden="true">4.3.</strong> with the Rust benchmark suite</a></li></ol></li><li class="chapter-item "><a href="../crates-io.html"><strong aria-hidden="true">5.</strong> crates.io Dependencies</a></li><li class="chapter-item affix "><li class="part-title">Contributing to Rust</li><li class="chapter-item "><a href="../contributing.html"><strong aria-hidden="true">6.</strong> Contribution Procedures</a></li><li class="chapter-item "><a href="../compiler-team.html"><strong aria-hidden="true">7.</strong> About the compiler team</a></li><li class="chapter-item "><a href="../git.html"><strong aria-hidden="true">8.</strong> Using Git</a></li><li class="chapter-item "><a href="../rustbot.html"><strong aria-hidden="true">9.</strong> Mastering @rustbot</a></li><li class="chapter-item "><a href="../walkthrough.html"><strong aria-hidden="true">10.</strong> Walkthrough: a typical contribution</a></li><li class="chapter-item "><a href="../implementing_new_features.html"><strong aria-hidden="true">11.</strong> Implementing new language features</a></li><li class="chapter-item "><a href="../stability.html"><strong aria-hidden="true">12.</strong> Stability attributes</a></li><li class="chapter-item "><a href="../stabilization_guide.html"><strong aria-hidden="true">13.</strong> Stabilizing Features</a></li><li class="chapter-item "><a href="../feature-gates.html"><strong aria-hidden="true">14.</strong> Feature Gates</a></li><li class="chapter-item "><a href="../conventions.html"><strong aria-hidden="true">15.</strong> Coding conventions</a></li><li class="chapter-item "><a href="../bug-fix-procedure.html"><strong aria-hidden="true">16.</strong> Procedures for Breaking Changes</a></li><li class="chapter-item "><a href="../external-repos.html"><strong aria-hidden="true">17.</strong> Using external repositories</a></li><li class="chapter-item "><a href="../fuzzing.html"><strong aria-hidden="true">18.</strong> Fuzzing</a></li><li class="chapter-item "><a href="../notification-groups/about.html"><strong aria-hidden="true">19.</strong> Notification groups</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../notification-groups/apple.html"><strong aria-hidden="true">19.1.</strong> Apple</a></li><li class="chapter-item "><a href="../notification-groups/arm.html"><strong aria-hidden="true">19.2.</strong> ARM</a></li><li class="chapter-item "><a href="../notification-groups/cleanup-crew.html"><strong aria-hidden="true">19.3.</strong> Cleanup Crew</a></li><li class="chapter-item "><a href="../notification-groups/emscripten.html"><strong aria-hidden="true">19.4.</strong> Emscripten</a></li><li class="chapter-item "><a href="../notification-groups/fuchsia.html"><strong aria-hidden="true">19.5.</strong> Fuchsia</a></li><li class="chapter-item "><a href="../notification-groups/llvm.html"><strong aria-hidden="true">19.6.</strong> LLVM</a></li><li class="chapter-item "><a href="../notification-groups/risc-v.html"><strong aria-hidden="true">19.7.</strong> RISC-V</a></li><li class="chapter-item "><a href="../notification-groups/rust-for-linux.html"><strong aria-hidden="true">19.8.</strong> Rust for Linux</a></li><li class="chapter-item "><a href="../notification-groups/wasi.html"><strong aria-hidden="true">19.9.</strong> WASI</a></li><li class="chapter-item "><a href="../notification-groups/wasm.html"><strong aria-hidden="true">19.10.</strong> WebAssembly</a></li><li class="chapter-item "><a href="../notification-groups/windows.html"><strong aria-hidden="true">19.11.</strong> Windows</a></li></ol></li><li class="chapter-item "><a href="../licenses.html"><strong aria-hidden="true">20.</strong> Licenses</a></li><li class="chapter-item "><a href="../guides/editions.html"><strong aria-hidden="true">21.</strong> Editions</a></li><li class="chapter-item affix "><li class="part-title">Bootstrapping</li><li class="chapter-item "><a href="../building/bootstrapping/intro.html"><strong aria-hidden="true">22.</strong> Prologue</a></li><li class="chapter-item "><a href="../building/bootstrapping/what-bootstrapping-does.html"><strong aria-hidden="true">23.</strong> What Bootstrapping does</a></li><li class="chapter-item "><a href="../building/bootstrapping/how-bootstrap-does-it.html"><strong aria-hidden="true">24.</strong> How Bootstrap does it</a></li><li class="chapter-item "><a href="../building/bootstrapping/writing-tools-in-bootstrap.html"><strong aria-hidden="true">25.</strong> Writing tools in Bootstrap</a></li><li class="chapter-item "><a href="../building/bootstrapping/debugging-bootstrap.html"><strong aria-hidden="true">26.</strong> Debugging bootstrap</a></li><li class="chapter-item affix "><li class="part-title">High-level Compiler Architecture</li><li class="chapter-item "><a href="../part-2-intro.html"><strong aria-hidden="true">27.</strong> Prologue</a></li><li class="chapter-item "><a href="../overview.html"><strong aria-hidden="true">28.</strong> Overview of the compiler</a></li><li class="chapter-item "><a href="../compiler-src.html"><strong aria-hidden="true">29.</strong> The compiler source code</a></li><li class="chapter-item "><a href="../query.html"><strong aria-hidden="true">30.</strong> Queries: demand-driven compilation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../queries/query-evaluation-model-in-detail.html"><strong aria-hidden="true">30.1.</strong> The Query Evaluation Model in Detail</a></li><li class="chapter-item "><a href="../queries/incremental-compilation.html"><strong aria-hidden="true">30.2.</strong> Incremental compilation</a></li><li class="chapter-item "><a href="../queries/incremental-compilation-in-detail.html"><strong aria-hidden="true">30.3.</strong> Incremental compilation In Detail</a></li><li class="chapter-item "><a href="../incrcomp-debugging.html"><strong aria-hidden="true">30.4.</strong> Debugging and Testing</a></li><li class="chapter-item "><a href="../queries/salsa.html"><strong aria-hidden="true">30.5.</strong> Salsa</a></li></ol></li><li class="chapter-item "><a href="../memory.html"><strong aria-hidden="true">31.</strong> Memory Management in Rustc</a></li><li class="chapter-item "><a href="../serialization.html"><strong aria-hidden="true">32.</strong> Serialization in Rustc</a></li><li class="chapter-item "><a href="../parallel-rustc.html"><strong aria-hidden="true">33.</strong> Parallel Compilation</a></li><li class="chapter-item expanded "><a href="../rustdoc-internals.html"><strong aria-hidden="true">34.</strong> Rustdoc internals</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rustdoc-internals/search.html" class="active"><strong aria-hidden="true">34.1.</strong> Search</a></li><li class="chapter-item "><a href="../rustdoc-internals/rustdoc-test-suite.html"><strong aria-hidden="true">34.2.</strong> The rustdoc test suite</a></li></ol></li><li class="chapter-item "><li class="part-title">Source Code Representation</li><li class="chapter-item "><a href="../part-3-intro.html"><strong aria-hidden="true">35.</strong> Prologue</a></li><li class="chapter-item "><a href="../syntax-intro.html"><strong aria-hidden="true">36.</strong> Syntax and the AST</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../the-parser.html"><strong aria-hidden="true">36.1.</strong> Lexing and Parsing</a></li><li class="chapter-item "><a href="../macro-expansion.html"><strong aria-hidden="true">36.2.</strong> Macro expansion</a></li><li class="chapter-item "><a href="../name-resolution.html"><strong aria-hidden="true">36.3.</strong> Name resolution</a></li><li class="chapter-item "><a href="../attributes.html"><strong aria-hidden="true">36.4.</strong> Attributes</a></li><li class="chapter-item "><a href="../test-implementation.html"><strong aria-hidden="true">36.5.</strong> #[test] Implementation</a></li><li class="chapter-item "><a href="../panic-implementation.html"><strong aria-hidden="true">36.6.</strong> Panic Implementation</a></li><li class="chapter-item "><a href="../ast-validation.html"><strong aria-hidden="true">36.7.</strong> AST Validation</a></li><li class="chapter-item "><a href="../feature-gate-ck.html"><strong aria-hidden="true">36.8.</strong> Feature Gate Checking</a></li><li class="chapter-item "><a href="../lang-items.html"><strong aria-hidden="true">36.9.</strong> Lang Items</a></li></ol></li><li class="chapter-item "><a href="../hir.html"><strong aria-hidden="true">37.</strong> The HIR (High-level IR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ast-lowering.html"><strong aria-hidden="true">37.1.</strong> Lowering AST to HIR</a></li><li class="chapter-item "><a href="../hir-debugging.html"><strong aria-hidden="true">37.2.</strong> Debugging</a></li></ol></li><li class="chapter-item "><a href="../thir.html"><strong aria-hidden="true">38.</strong> The THIR (Typed High-level IR)</a></li><li class="chapter-item "><a href="../mir/index.html"><strong aria-hidden="true">39.</strong> The MIR (Mid-level IR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../mir/construction.html"><strong aria-hidden="true">39.1.</strong> MIR construction</a></li><li class="chapter-item "><a href="../mir/visitor.html"><strong aria-hidden="true">39.2.</strong> MIR visitor and traversal</a></li><li class="chapter-item "><a href="../mir/passes.html"><strong aria-hidden="true">39.3.</strong> MIR queries and passes: getting the MIR</a></li></ol></li><li class="chapter-item "><a href="../asm.html"><strong aria-hidden="true">40.</strong> Inline assembly</a></li><li class="chapter-item affix "><li class="part-title">Supporting Infrastructure</li><li class="chapter-item "><a href="../cli.html"><strong aria-hidden="true">41.</strong> Command-line arguments</a></li><li class="chapter-item "><a href="../rustc-driver/intro.html"><strong aria-hidden="true">42.</strong> rustc_driver and rustc_interface</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rustc-driver/interacting-with-the-ast.html"><strong aria-hidden="true">42.1.</strong> Example: Type checking</a></li><li class="chapter-item "><a href="../rustc-driver/getting-diagnostics.html"><strong aria-hidden="true">42.2.</strong> Example: Getting diagnostics</a></li><li class="chapter-item "><a href="../rustc-driver/remarks-on-perma-unstable-features.html"><strong aria-hidden="true">42.3.</strong> Remarks on perma-unstable features</a></li></ol></li><li class="chapter-item "><a href="../diagnostics.html"><strong aria-hidden="true">43.</strong> Errors and Lints</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../diagnostics/diagnostic-structs.html"><strong aria-hidden="true">43.1.</strong> Diagnostic and subdiagnostic structs</a></li><li class="chapter-item "><a href="../diagnostics/translation.html"><strong aria-hidden="true">43.2.</strong> Translation</a></li><li class="chapter-item "><a href="../diagnostics/lintstore.html"><strong aria-hidden="true">43.3.</strong> LintStore</a></li><li class="chapter-item "><a href="../diagnostics/error-codes.html"><strong aria-hidden="true">43.4.</strong> Error codes</a></li><li class="chapter-item "><a href="../diagnostics/diagnostic-items.html"><strong aria-hidden="true">43.5.</strong> Diagnostic items</a></li><li class="chapter-item "><a href="../diagnostics/error-guaranteed.html"><strong aria-hidden="true">43.6.</strong> ErrorGuaranteed</a></li></ol></li><li class="chapter-item "><li class="part-title">Analysis</li><li class="chapter-item "><a href="../part-4-intro.html"><strong aria-hidden="true">44.</strong> Prologue</a></li><li class="chapter-item "><a href="../generic_parameters_summary.html"><strong aria-hidden="true">45.</strong> Generic parameter definitions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ty_module/early_binder.html"><strong aria-hidden="true">45.1.</strong> EarlyBinder and instantiating parameters</a></li></ol></li><li class="chapter-item "><a href="../ty_module/binders.html"><strong aria-hidden="true">46.</strong> Binders and Higher ranked regions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ty_module/instantiating_binders.html"><strong aria-hidden="true">46.1.</strong> Instantiating binders</a></li></ol></li><li class="chapter-item "><a href="../early_late_parameters.html"><strong aria-hidden="true">47.</strong> Early vs Late bound parameters</a></li><li class="chapter-item "><a href="../ty.html"><strong aria-hidden="true">48.</strong> The ty module: representing types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ty_module/generic_arguments.html"><strong aria-hidden="true">48.1.</strong> ADTs and Generic Arguments</a></li><li class="chapter-item "><a href="../ty_module/param_ty_const_regions.html"><strong aria-hidden="true">48.2.</strong> Parameter types/consts/regions</a></li></ol></li><li class="chapter-item "><a href="../ty-fold.html"><strong aria-hidden="true">49.</strong> TypeFolder and TypeFoldable</a></li><li class="chapter-item "><a href="../typing_parameter_envs.html"><strong aria-hidden="true">50.</strong> Typing/Param Envs</a></li><li class="chapter-item "><a href="../type-inference.html"><strong aria-hidden="true">51.</strong> Type inference</a></li><li class="chapter-item "><a href="../traits/resolution.html"><strong aria-hidden="true">52.</strong> Trait solving</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../traits/hrtb.html"><strong aria-hidden="true">52.1.</strong> Higher-ranked trait bounds</a></li><li class="chapter-item "><a href="../traits/caching.html"><strong aria-hidden="true">52.2.</strong> Caching subtleties</a></li><li class="chapter-item "><a href="../traits/implied-bounds.html"><strong aria-hidden="true">52.3.</strong> Implied bounds</a></li><li class="chapter-item "><a href="../traits/specialization.html"><strong aria-hidden="true">52.4.</strong> Specialization</a></li><li class="chapter-item "><a href="../traits/chalk.html"><strong aria-hidden="true">52.5.</strong> Chalk-based trait solving</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../traits/lowering-to-logic.html"><strong aria-hidden="true">52.5.1.</strong> Lowering to logic</a></li><li class="chapter-item "><a href="../traits/goals-and-clauses.html"><strong aria-hidden="true">52.5.2.</strong> Goals and clauses</a></li><li class="chapter-item "><a href="../traits/canonical-queries.html"><strong aria-hidden="true">52.5.3.</strong> Canonical queries</a></li><li class="chapter-item "><a href="../traits/canonicalization.html"><strong aria-hidden="true">52.5.4.</strong> Canonicalization</a></li></ol></li><li class="chapter-item "><a href="../solve/trait-solving.html"><strong aria-hidden="true">52.6.</strong> Next-gen trait solving</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../solve/invariants.html"><strong aria-hidden="true">52.6.1.</strong> Invariants of the type system</a></li><li class="chapter-item "><a href="../solve/the-solver.html"><strong aria-hidden="true">52.6.2.</strong> The solver</a></li><li class="chapter-item "><a href="../solve/canonicalization.html"><strong aria-hidden="true">52.6.3.</strong> Canonicalization</a></li><li class="chapter-item "><a href="../solve/coinduction.html"><strong aria-hidden="true">52.6.4.</strong> Coinduction</a></li><li class="chapter-item "><a href="../solve/caching.html"><strong aria-hidden="true">52.6.5.</strong> Caching</a></li><li class="chapter-item "><a href="../solve/proof-trees.html"><strong aria-hidden="true">52.6.6.</strong> Proof trees</a></li><li class="chapter-item "><a href="../solve/normalization.html"><strong aria-hidden="true">52.6.7.</strong> Normalization</a></li><li class="chapter-item "><a href="../solve/opaque-types.html"><strong aria-hidden="true">52.6.8.</strong> Opaque types</a></li><li class="chapter-item "><a href="../solve/significant-changes.html"><strong aria-hidden="true">52.6.9.</strong> Significant changes and quirks</a></li></ol></li><li class="chapter-item "><a href="../traits/unsize.html"><strong aria-hidden="true">52.7.</strong> Unsize and CoerceUnsized traits</a></li></ol></li><li class="chapter-item "><a href="../type-checking.html"><strong aria-hidden="true">53.</strong> Type checking</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../method-lookup.html"><strong aria-hidden="true">53.1.</strong> Method Lookup</a></li><li class="chapter-item "><a href="../variance.html"><strong aria-hidden="true">53.2.</strong> Variance</a></li><li class="chapter-item "><a href="../coherence.html"><strong aria-hidden="true">53.3.</strong> Coherence Checking</a></li><li class="chapter-item "><a href="../opaque-types-type-alias-impl-trait.html"><strong aria-hidden="true">53.4.</strong> Opaque Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../opaque-types-impl-trait-inference.html"><strong aria-hidden="true">53.4.1.</strong> Inference details</a></li><li class="chapter-item "><a href="../return-position-impl-trait-in-trait.html"><strong aria-hidden="true">53.4.2.</strong> Return Position Impl Trait In Trait</a></li><li class="chapter-item "><a href="../borrow_check/opaque-types-region-inference-restrictions.html"><strong aria-hidden="true">53.4.3.</strong> Region inference restrictions</a></li></ol></li></ol></li><li class="chapter-item "><a href="../effects.html"><strong aria-hidden="true">54.</strong> Const condition checking</a></li><li class="chapter-item "><a href="../pat-exhaustive-checking.html"><strong aria-hidden="true">55.</strong> Pattern and Exhaustiveness Checking</a></li><li class="chapter-item "><a href="../unsafety-checking.html"><strong aria-hidden="true">56.</strong> Unsafety Checking</a></li><li class="chapter-item "><a href="../mir/dataflow.html"><strong aria-hidden="true">57.</strong> MIR dataflow</a></li><li class="chapter-item "><a href="../mir/drop-elaboration.html"><strong aria-hidden="true">58.</strong> Drop elaboration</a></li><li class="chapter-item "><a href="../borrow_check.html"><strong aria-hidden="true">59.</strong> The borrow checker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../borrow_check/moves_and_initialization.html"><strong aria-hidden="true">59.1.</strong> Tracking moves and initialization</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../borrow_check/moves_and_initialization/move_paths.html"><strong aria-hidden="true">59.1.1.</strong> Move paths</a></li></ol></li><li class="chapter-item "><a href="../borrow_check/type_check.html"><strong aria-hidden="true">59.2.</strong> MIR type checker</a></li><li class="chapter-item "><a href="../borrow_check/drop_check.html"><strong aria-hidden="true">59.3.</strong> Drop check</a></li><li class="chapter-item "><a href="../borrow_check/region_inference.html"><strong aria-hidden="true">59.4.</strong> Region inference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../borrow_check/region_inference/constraint_propagation.html"><strong aria-hidden="true">59.4.1.</strong> Constraint propagation</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/lifetime_parameters.html"><strong aria-hidden="true">59.4.2.</strong> Lifetime parameters</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/member_constraints.html"><strong aria-hidden="true">59.4.3.</strong> Member constraints</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/placeholders_and_universes.html"><strong aria-hidden="true">59.4.4.</strong> Placeholders and universes</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/closure_constraints.html"><strong aria-hidden="true">59.4.5.</strong> Closure constraints</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/error_reporting.html"><strong aria-hidden="true">59.4.6.</strong> Error reporting</a></li></ol></li><li class="chapter-item "><a href="../borrow_check/two_phase_borrows.html"><strong aria-hidden="true">59.5.</strong> Two-phase-borrows</a></li></ol></li><li class="chapter-item "><a href="../closure.html"><strong aria-hidden="true">60.</strong> Closure capture inference</a></li><li class="chapter-item "><a href="../coroutine-closures.html"><strong aria-hidden="true">61.</strong> Async closures/"coroutine-closures"</a></li><li class="chapter-item affix "><li class="part-title">MIR to Binaries</li><li class="chapter-item "><a href="../part-5-intro.html"><strong aria-hidden="true">62.</strong> Prologue</a></li><li class="chapter-item "><a href="../mir/optimizations.html"><strong aria-hidden="true">63.</strong> MIR optimizations</a></li><li class="chapter-item "><a href="../mir/debugging.html"><strong aria-hidden="true">64.</strong> Debugging MIR</a></li><li class="chapter-item "><a href="../const-eval.html"><strong aria-hidden="true">65.</strong> Constant evaluation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../const-eval/interpret.html"><strong aria-hidden="true">65.1.</strong> Interpreter</a></li></ol></li><li class="chapter-item "><a href="../backend/monomorph.html"><strong aria-hidden="true">66.</strong> Monomorphization</a></li><li class="chapter-item "><a href="../backend/lowering-mir.html"><strong aria-hidden="true">67.</strong> Lowering MIR</a></li><li class="chapter-item "><a href="../backend/codegen.html"><strong aria-hidden="true">68.</strong> Code Generation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../backend/updating-llvm.html"><strong aria-hidden="true">68.1.</strong> Updating LLVM</a></li><li class="chapter-item "><a href="../backend/debugging.html"><strong aria-hidden="true">68.2.</strong> Debugging LLVM</a></li><li class="chapter-item "><a href="../backend/backend-agnostic.html"><strong aria-hidden="true">68.3.</strong> Backend Agnostic Codegen</a></li><li class="chapter-item "><a href="../backend/implicit-caller-location.html"><strong aria-hidden="true">68.4.</strong> Implicit Caller Location</a></li></ol></li><li class="chapter-item "><a href="../backend/libs-and-metadata.html"><strong aria-hidden="true">69.</strong> Libraries and Metadata</a></li><li class="chapter-item "><a href="../profile-guided-optimization.html"><strong aria-hidden="true">70.</strong> Profile-guided Optimization</a></li><li class="chapter-item "><a href="../llvm-coverage-instrumentation.html"><strong aria-hidden="true">71.</strong> LLVM Source-Based Code Coverage</a></li><li class="chapter-item "><a href="../sanitizers.html"><strong aria-hidden="true">72.</strong> Sanitizers Support</a></li><li class="chapter-item "><a href="../debugging-support-in-rustc.html"><strong aria-hidden="true">73.</strong> Debugging support in the Rust compiler</a></li><li class="spacer"></li><li class="chapter-item affix "><a href="../appendix/background.html">Appendix A: Background topics</a></li><li class="chapter-item affix "><a href="../appendix/glossary.html">Appendix B: Glossary</a></li><li class="chapter-item affix "><a href="../appendix/code-index.html">Appendix C: Code Index</a></li><li class="chapter-item affix "><a href="../appendix/compiler-lecture.html">Appendix D: Compiler Lecture Series</a></li><li class="chapter-item affix "><a href="../appendix/bibliography.html">Appendix E: Bibliography</a></li><li class="chapter-item affix "><a href="../appendix/humorust.html">Appendix Z: HumorRust</a></li><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Compiler Development Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rustc-dev-guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rustc-dev-guide/edit/master/src/rustdoc-internals/search.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rustdoc-search"><a class="header" href="#rustdoc-search">Rustdoc search</a></h1>
<p>Rustdoc Search is two programs: <code>search_index.rs</code>
and <code>search.js</code>. The first generates a nasty JSON
file with a full list of items and function signatures
in the crates in the doc bundle, and the second reads
it, turns it into some in-memory structures, and
scans them linearly to search.</p>
<ul>
<li><a href="#search-index-format">Search index format</a>
<ul>
<li><a href="#parallel-arrays-and-indexed-maps">Parallel arrays and indexed maps</a></li>
<li><a href="#representing-sparse-columns">Representing sparse columns</a>
<ul>
<li><a href="#vlq-hex">VLQ Hex</a></li>
<li><a href="#roaring-bitmaps">Roaring Bitmaps</a></li>
</ul>
</li>
<li><a href="#how-descriptions-are-stored">How descriptions are stored</a></li>
<li><a href="#i-f-and-p"><code>i</code>, <code>f</code>, and <code>p</code></a></li>
</ul>
</li>
<li><a href="#searching-by-name">Searching by name</a></li>
<li><a href="#searching-by-type">Searching by type</a></li>
<li><a href="#re-exports">Re-exports</a></li>
<li><a href="#testing-the-search-engine">Testing the search engine</a></li>
</ul>
<h2 id="search-index-format"><a class="header" href="#search-index-format">Search index format</a></h2>
<p><code>search.js</code> calls this Raw, because it turns it into
a more normal object tree after loading it.
For space savings, it's also written without newlines or spaces.</p>
<pre><code class="language-json">[
    [ &quot;crate_name&quot;, {
        // name
        &quot;n&quot;: [&quot;function_name&quot;, &quot;Data&quot;],
        // type
        &quot;t&quot;: &quot;HF&quot;,
        // parent module
        &quot;q&quot;: [[0, &quot;crate_name&quot;]],
        // parent type
        &quot;i&quot;: [2, 0],
        // type dictionary
        &quot;p&quot;: [[1, &quot;i32&quot;], [1, &quot;str&quot;], [5, &quot;Data&quot;, 0]],
        // function signature
        &quot;f&quot;: &quot;{{gb}{d}}`&quot;, // [[3, 1], [2]]
        // impl disambiguator
        &quot;b&quot;: [],
        // deprecated flag
        &quot;c&quot;: &quot;OjAAAAAAAAA=&quot;, // empty bitmap
        // empty description flag
        &quot;e&quot;: &quot;OjAAAAAAAAA=&quot;, // empty bitmap
        // aliases
        &quot;a&quot;: [[&quot;get_name&quot;, 0]],
        // description shards
        &quot;D&quot;: &quot;g&quot;, // 3
        // inlined re-exports
        &quot;r&quot;: [],
    }]
]
</code></pre>
<p><a href="https://github.com/rust-lang/rust/blob/2f92f050e83bf3312ce4ba73c31fe843ad3cbc60/src/librustdoc/html/static/js/rustdoc.d.ts#L344-L390"><code>src/librustdoc/html/static/js/rustdoc.d.ts</code></a>
defines an actual schema in a TypeScript <code>type</code>.</p>
<div class="table-wrapper"><table><thead><tr><th>Key</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td><code>n</code></td><td>Names</td><td>Item names</td></tr>
<tr><td><code>t</code></td><td>Item Type</td><td>One-char item type code</td></tr>
<tr><td><code>q</code></td><td>Parent module</td><td><code>Map&lt;index, path&gt;</code></td></tr>
<tr><td><code>i</code></td><td>Parent type</td><td>list of indexes</td></tr>
<tr><td><code>f</code></td><td>Function signature</td><td><a href="#i-f-and-p">encoded</a></td></tr>
<tr><td><code>b</code></td><td>Impl disambiguator</td><td><code>Map&lt;index, string&gt;</code></td></tr>
<tr><td><code>c</code></td><td>Deprecation flag</td><td><a href="#roaring-bitmaps">roaring bitmap</a></td></tr>
<tr><td><code>e</code></td><td>Description is empty</td><td><a href="#roaring-bitmaps">roaring bitmap</a></td></tr>
<tr><td><code>p</code></td><td>Type dictionary</td><td><code>[[item type, path]]</code></td></tr>
<tr><td><code>a</code></td><td>Alias</td><td><code>Map&lt;string, index&gt;</code></td></tr>
<tr><td><code>D</code></td><td>description shards</td><td><a href="#how-descriptions-are-stored">encoded</a></td></tr>
</tbody></table>
</div>
<p>The above index defines a crate called <code>crate_name</code>
with a free function called <code>function_name</code> and a struct called <code>Data</code>,
with the type signature <code>Data, i32 -&gt; str</code>,
and an alias, <code>get_name</code>, that equivalently refers to <code>function_name</code>.</p>
<p>The search index needs to fit the needs of the <code>rustdoc</code> compiler,
the <code>search.js</code> frontend,
and also be compact and fast to decode.
It makes a lot of compromises:</p>
<ul>
<li>The <code>rustdoc</code> compiler runs on one crate at a time,
so each crate has an essentially separate search index.
It <a href="https://github.com/rust-lang/rust/blob/79b710c13968a1a48d94431d024d2b1677940866/src/librustdoc/html/render/write_shared.rs#L151-L164">merges</a> them by having each crate on one line
and looking at the first quoted string.</li>
<li>Names in the search index are given
in their original case and with underscores.
When the search index is loaded,
<code>search.js</code> stores the original names for display,
but also folds them to lowercase and strips underscores for search.
You'll see them called <code>normalized</code>.</li>
<li>The <code>f</code> array stores types as offsets into the <code>p</code> array.
These types might actually be from another crate,
so <code>search.js</code> has to turn the numbers into names and then
back into numbers to deduplicate them if multiple crates in the
same index mention the same types.</li>
<li>It's a JSON file, but not designed to be human-readable.
Browsers already include an optimized JSON decoder,
so this saves on <code>search.js</code> code and performs better for small crates,
but instead of using objects like normal JSON formats do,
it tries to put data of the same type next to each other
so that the sliding window used by <a href="https://en.wikipedia.org/wiki/Deflate">DEFLATE</a> can find redundancies.
Where <code>search.js</code> does its own compression,
it's designed to save memory when the file is finally loaded,
not just size on disk or network transfer.</li>
</ul>
<h3 id="parallel-arrays-and-indexed-maps"><a class="header" href="#parallel-arrays-and-indexed-maps">Parallel arrays and indexed maps</a></h3>
<p>Abstractly, Rustdoc Search data is a table, stored in column-major form.
Most data in the index represents a set of parallel arrays
(the &quot;columns&quot;) which refer to the same data if they're at the same position.</p>
<p>For example,
the above search index can be turned into this table:</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>n</th><th>t</th><th><a href="#how-descriptions-are-stored">d</a></th><th>q</th><th>i</th><th>f</th><th>b</th><th>c</th></tr></thead><tbody>
<tr><td>0</td><td><code>crate_name</code></td><td><code>D</code></td><td>Documentation</td><td>NULL</td><td>0</td><td>NULL</td><td>NULL</td><td>0</td></tr>
<tr><td>1</td><td><code>function_name</code></td><td><code>H</code></td><td>This function gets the name of an integer with Data</td><td><code>crate_name</code></td><td>2</td><td><code>{{gb}{d}}</code></td><td>NULL</td><td>0</td></tr>
<tr><td>2</td><td><code>Data</code></td><td><code>F</code></td><td>The data struct</td><td><code>crate_name</code></td><td>0</td><td><code>`</code></td><td>NULL</td><td>0</td></tr>
</tbody></table>
</div>
<p>The crate row is implied in most columns, since its type is known (it's a crate),
it can't have a parent (crates form the root of the module tree),
its name is specified as the map key,
and function-specific data like the impl disambiguator can't apply either.
However, it can still have a description and it can still be deprecated.
The crate, therefore, has a primary key of <code>0</code>.</p>
<p>The above code doesn't use <code>c</code>, which holds deprecated indices,
or <code>b</code>, which maps indices to strings.
If <code>crate_name::function_name</code> used both, it might look like this.</p>
<pre><code class="language-json">        &quot;b&quot;: [[0, &quot;impl-Foo-for-Bar&quot;]],
        &quot;c&quot;: &quot;OjAAAAEAAAAAAAIAEAAAABUAbgZYCQ==&quot;,
</code></pre>
<p>This attaches a disambiguator to index 1 and marks it deprecated.</p>
<p>The advantage of this layout is that these APIs often have implicit structure
that DEFLATE can take advantage of,
but that rustdoc can't assume.
Like how names are usually CamelCase or snake_case,
but descriptions aren't.
It also makes it easier to use a sparse data for things like boolean flags.</p>
<p><code>q</code> is a Map from <em>the first applicable</em> ID to a parent module path.
This is a weird trick, but it makes more sense in pseudo-code:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut parent_module = &quot;&quot;;
for (i, entry) in search_index.iter().enumerate() {
    if q.contains(i) {
        parent_module = q.get(i);
    }
    // ... do other stuff with `entry` ...
}
<span class="boring">}
</span></code></pre></pre>
<p>This is valid because everything has a parent module
(even if it's just the crate itself),
and is easy to assemble because the rustdoc generator sorts by path
before serializing.
Doing this allows rustdoc to not only make the search index smaller,
but reuse the same string representing the parent path across multiple in-memory items.</p>
<h3 id="representing-sparse-columns"><a class="header" href="#representing-sparse-columns">Representing sparse columns</a></h3>
<h4 id="vlq-hex"><a class="header" href="#vlq-hex">VLQ Hex</a></h4>
<p>This format is, as far as I know, used nowhere other than rustdoc.
It follows this grammar:</p>
<pre><code class="language-ebnf">VLQHex = { VHItem | VHBackref }
VHItem = VHNumber | ( '{', {VHItem}, '}' )
VHNumber = { '@' | 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G' | 'H' | 'I' | 'J' | 'K' | 'L' | 'M' | 'N' | 'O' }, ( '`' | 'a' | 'b' | 'c' | 'd' | 'e' | 'f' | 'g' | 'h' | 'i' | 'j' | 'k ' | 'l' | 'm' | 'n' | 'o' )
VHBackref = ( '0' | '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9' | ':' | ';' | '&lt;' | '=' | '&gt;' | '?' )
</code></pre>
<p>A VHNumber is a variable-length, self-terminating base16 number
(terminated because the last hexit is lowercase while all others are uppercase).
The sign bit is represented using <a href="https://en.wikipedia.org/wiki/Variable-length_quantity#Zigzag_encoding">zig-zag encoding</a>.</p>
<p>This alphabet is chosen because the characters can be turned into hexits by
masking off the last four bits of the ASCII encoding.</p>
<p>A major feature of this encoding, as with all of the &quot;compression&quot; done in rustdoc,
is that it can remain in its compressed format <em>even in memory at runtime</em>.
This is why <code>HBackref</code> is only used at the top level,
and why we don't just use <a href="https://en.wikipedia.org/wiki/Deflate">Flate</a> for everything: the decoder in search.js
will reuse the entire decoded object whenever a backref is seen,
saving decode work and memory.</p>
<h4 id="roaring-bitmaps"><a class="header" href="#roaring-bitmaps">Roaring Bitmaps</a></h4>
<p>Flag-style data, such as deprecation and empty descriptions,
are stored using the <a href="https://github.com/RoaringBitmap/RoaringFormatSpec">standard Roaring Bitmap serialization format with runs</a>.
The data is then base64 encoded when writing it.</p>
<p>As a brief overview: a roaring bitmap is a chunked array of bits,
described in <a href="https://arxiv.org/pdf/1603.06549.pdf">this paper</a>.
A chunk can either be a list of integers, a bitfield, or a list of runs.
In any case, the search engine has to base64 decode it,
and read the chunk index itself,
but the payload data stays as-is.</p>
<p>All roaring bitmaps in rustdoc currently store a flag for each item index.
The crate is item 0, all others start at 1.</p>
<h3 id="how-descriptions-are-stored"><a class="header" href="#how-descriptions-are-stored">How descriptions are stored</a></h3>
<p>The largest amount of data,
and the main thing Rustdoc Search deals with that isn't
actually used for searching, is descriptions.
In a SERP table, this is what appears on the rightmost column.</p>
<blockquote>
<div class="table-wrapper"><table><thead><tr><th>item type</th><th>item path</th><th><em><strong>description</strong></em> (this part)</th></tr></thead><tbody>
<tr><td>function</td><td>my_crate::my_function</td><td>This function gets the name of an integer with Data</td></tr>
</tbody></table>
</div></blockquote>
<p>When someone runs a search in rustdoc for the first time, their browser will
work through a &quot;sandwich workload&quot; of three steps:</p>
<ol>
<li>Download the search-index.js and search.js files (a network bottleneck).</li>
<li>Perform the actual search (a CPU and memory bandwidth bottleneck).</li>
<li>Download the description data (another network bottleneck).</li>
</ol>
<p>Reducing the amount of data downloaded here will almost always increase latency,
by delaying the decision of what to download behind other work and/or adding
data dependencies where something can't be downloaded without first downloading
something else. In this case, we can't start downloading descriptions until
after the search is done, because that's what allows it to decide <em>which</em>
descriptions to download (it needs to sort the results then truncate to 200).</p>
<p>To do this, two columns are stored in the search index, building on both
Roaring Bitmaps and on VLQ Hex.</p>
<ul>
<li><code>e</code> is an index of <strong>e</strong>mpty descriptions. It's a <a href="#roaring-bitmaps">roaring bitmap</a> of
each item (the crate itself is item 0, the rest start at 1).</li>
<li><code>D</code> is a shard list, stored in <a href="#vlq-hex">VLQ hex</a> as flat list of integers.
Each integer gives you the number of descriptions in the shard.
As the decoder walks the index, it checks if the description is empty.
if it's not, then it's in the &quot;current&quot; shard. When all items are
exhausted, it goes on to the next shard.</li>
</ul>
<p>Inside each shard is a newline-delimited list of descriptions,
wrapped in a JSONP-style function call.</p>
<h3 id="i-f-and-p"><a class="header" href="#i-f-and-p"><code>i</code>, <code>f</code>, and <code>p</code></a></h3>
<p><code>i</code> and <code>f</code> both index into <code>p</code>, the array of parent items.</p>
<p><code>i</code> is just a one-indexed number
(not zero-indexed because <code>0</code> is used for items that have no parent item).
It's different from <code>q</code> because <code>q</code> represents the parent <em>module or crate</em>,
which everything has,
while <code>i</code>/<code>q</code> are used for <em>type and trait-associated items</em> like methods.</p>
<p><code>f</code>, the function signatures, use a <a href="#vlq-hex">VLQ hex</a> tree.
A number is either a one-indexed reference into <code>p</code>,
a negative number representing a generic,
or zero for null.</p>
<p>(the internal object representation also uses negative numbers,
even after decoding,
to represent generics).</p>
<p>For example, <code>{{gb}{d}}</code> is equivalent to the json <code>[[3, 1], [2]]</code>.
Because of zigzag encoding, <code>`</code> is +0, <code>a</code> is -0 (which is not used),
<code>b</code> is +1, and <code>c</code> is -1.</p>
<h2 id="searching-by-name"><a class="header" href="#searching-by-name">Searching by name</a></h2>
<p>Searching by name works by looping through the search index
and running these functions on each:</p>
<ul>
<li><a href="https://github.com/rust-lang/rust/blob/79b710c13968a1a48d94431d024d2b1677940866/src/librustdoc/html/static/js/search.js#L137"><code>editDistance</code></a> is always used to determine a match
(unless quotes are specified, which would use simple equality instead).
It computes the number of swaps, inserts, and removes needed to turn
the query name into the entry name.
For example, <code>foo</code> has zero distance from itself,
but a distance of 1 from <code>ofo</code> (one swap) and <code>foob</code> (one insert).
It is checked against an heuristic threshold, and then,
if it is within that threshold, the distance is stored for ranking.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/indexOf"><code>String.prototype.indexOf</code></a> is always used to determine a match.
If it returns anything other than -1, the result is added,
even if <code>editDistance</code> exceeds its threshold,
and the index is stored for ranking.</li>
<li><a href="https://github.com/rust-lang/rust/blob/79b710c13968a1a48d94431d024d2b1677940866/src/librustdoc/html/static/js/search.js#L1814"><code>checkPath</code></a> is used if, and only if, a parent path is specified
in the query. For example, <code>vec</code> has no parent path, but <code>vec::vec</code> does.
Within checkPath, editDistance and indexOf are used,
and the path query has its own heuristic threshold, too.
If it's not within the threshold, the entry is rejected,
even if the first two pass.
If it's within the threshold, the path distance is stored
for ranking.</li>
<li><a href="https://github.com/rust-lang/rust/blob/79b710c13968a1a48d94431d024d2b1677940866/src/librustdoc/html/static/js/search.js#L1787"><code>checkType</code></a> is used only if there's a type filter,
like the struct in <code>struct:vec</code>. If it fails,
the entry is rejected.</li>
</ul>
<p>If all four criteria pass
(plus the crate filter, which isn't technically part of the query),
the results are sorted by <a href="https://github.com/rust-lang/rust/blob/79b710c13968a1a48d94431d024d2b1677940866/src/librustdoc/html/static/js/search.js#L1229"><code>sortResults</code></a>.</p>
<h2 id="searching-by-type"><a class="header" href="#searching-by-type">Searching by type</a></h2>
<p>Searching by type can be divided into two phases,
and the second phase has two sub-phases.</p>
<ul>
<li>Turn names in the query into numbers.</li>
<li>Loop over each entry in the search index:
<ul>
<li>Quick rejection using a bloom filter.</li>
<li>Slow rejection using a recursive type unification algorithm.</li>
</ul>
</li>
</ul>
<p>In the names-&gt;numbers phase, if the query has only one name in it,
the editDistance function is used to find a near match if the exact match fails,
but if there's multiple items in the query,
non-matching items are treated as generics instead.
This means <code>hahsmap</code> will match hashmap on its own, but <code>hahsmap, u32</code>
is going to match the same things <code>T, u32</code> matches
(though rustdoc will detect this particular problem and warn about it).</p>
<p>Then, when actually looping over each item,
the bloom filter will probably reject entries that don't have every
type mentioned in the query.
For example, the bloom query allows a query of <code>i32 -&gt; u32</code> to match
a function with the type <code>i32, u32 -&gt; bool</code>,
but unification will reject it later.</p>
<p>The unification filter ensures that:</p>
<ul>
<li>Bag semantics are respected. If you query says <code>i32, i32</code>,
then the function has to mention <em>two</em> i32s, not just one.</li>
<li>Nesting semantics are respected. If your query says <code>vec&lt;option&gt;</code>,
then <code>vec&lt;option&lt;i32&gt;&gt;</code> is fine, but <code>option&lt;vec&lt;i32&gt;&gt;</code> <em>is not</em> a match.</li>
<li>The division between return type and parameter is respected.
<code>i32 -&gt; u32</code> and <code>u32 -&gt; i32</code> are completely different.</li>
</ul>
<p>The bloom filter checks none of these things,
and, on top of that, can have false positives.
But it's fast and uses very little memory, so the bloom filter helps.</p>
<h2 id="re-exports"><a class="header" href="#re-exports">Re-exports</a></h2>
<p><a href="https://doc.rust-lang.org/nightly/rustdoc/write-documentation/re-exports.html">Re-export inlining</a> allows the same item to be found by multiple names.
Search supports this by giving the same item multiple entries and tracking a canonical path
for any items where that differs from the given path.</p>
<p>For example, this sample index has a single struct exported from two paths:</p>
<pre><code class="language-json">[
    [ &quot;crate_name&quot;, {
        &quot;doc&quot;: &quot;Documentation&quot;,
        &quot;n&quot;: [&quot;Data&quot;, &quot;Data&quot;],
        &quot;t&quot;: &quot;FF&quot;,
        &quot;d&quot;: [&quot;The data struct&quot;, &quot;The data struct&quot;],
        &quot;q&quot;: [[0, &quot;crate_name&quot;], [1, &quot;crate_name::submodule&quot;]],
        &quot;i&quot;: [0, 0],
        &quot;p&quot;: [],
        &quot;f&quot;: &quot;``&quot;,
        &quot;b&quot;: [],
        &quot;c&quot;: [],
        &quot;a&quot;: [],
        &quot;r&quot;: [[0, 1]],
    }]
]
</code></pre>
<p>The important part of this example is the <code>r</code> array,
which indicates that path entry 1 in the <code>q</code> array is
the canonical path for item 0.
That is, <code>crate_name::Data</code> has a canonical path of <code>crate_name::submodule::Data</code>.</p>
<p>This might sound like a strange design, since it has the duplicate data.
It's done that way because inlining can happen across crates,
which are compiled separately and might not all be present in the docs.</p>
<pre><code class="language-json">[
  [ &quot;crate_name&quot;, ... ],
  [ &quot;crate_name_2&quot;, { &quot;q&quot;: [[0, &quot;crate_name::submodule&quot;], [5, &quot;core::option&quot;]], ... }]
]
</code></pre>
<p>In the above example, a canonical path actually comes from a dependency,
and another one comes from an inlined standard library item:
the canonical path isn't even in the index!
The canonical path might also be private.
In either case, it's never shown to the user, and is only used for deduplication.</p>
<p>Associated types, like methods, store them differently.
These types are connected with an entry in <code>p</code> (their &quot;parent&quot;)
and each one has an optional third tuple element:</p>
<pre><code>&quot;p&quot;: [[5, &quot;Data&quot;, 0, 1]]
</code></pre>
<p>That's:</p>
<ul>
<li>5: It's a struct</li>
<li>&quot;Data&quot;: Its name</li>
<li>0: Its display path, &quot;crate_name&quot;</li>
<li>1: Its canonical path, &quot;crate_name::submodule&quot;</li>
</ul>
<p>In both cases, the canonical path might not be public at all,
or it might be from another crate that isn't in the docs,
so it's never shown to the user, but is used for deduplication.</p>
<h2 id="testing-the-search-engine"><a class="header" href="#testing-the-search-engine">Testing the search engine</a></h2>
<p>While the generated UI is tested using <code>rustdoc-gui</code> tests, the
primary way the search engine is tested is the <code>rustdoc-js</code> and
<code>rustdoc-js-std</code> tests. They run in NodeJS.</p>
<p>A <code>rustdoc-js</code> test has a <code>.rs</code> and <code>.js</code> file, with the same name.
The <code>.rs</code> file specifies the hypothetical library crate to run
the searches on (make sure you mark anything you need to find as <code>pub</code>).
The <code>.js</code> file specifies the actual searches.
The <code>rustdoc-js-std</code> tests are the same, but don't require an <code>.rs</code>
file, since they use the standard library.</p>
<p>The <code>.js</code> file is like a module (except the loader takes care of
<code>exports</code> for you). It uses these variables:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>FILTER_CRATE</code></td><td><code>string</code></td><td>Only include results from the given crate. In the GUI, this is the &quot;Results in <kbd>crate</kbd>&quot; drop-down menu.</td></tr>
<tr><td><code>EXPECTED</code></td><td><code>[ResultsTable]\|ResultsTable</code></td><td>List of tests to run, specifying what the hypothetical user types into the search box and sees in the tabs</td></tr>
<tr><td><code>PARSED</code></td><td><code>[ParsedQuery]\|ParsedQuery</code></td><td>List of parser tests to run, without running an actual search</td></tr>
</tbody></table>
</div>
<p><code>FILTER_CRATE</code> can be left out (equivalent to searching &quot;all crates&quot;), but you
have to specify <code>EXPECTED</code> or <code>PARSED</code>.</p>
<p>By default, the test fails if any of the results specified in the test case are
not found after running the search, or if the results found after running the
search don't appear in the same order that they do in the test.
The actual search results may, however, include results that aren't in the test.
To override this, specify any of the following magic comments.
Put them on their own line, without indenting.</p>
<ul>
<li><code>// exact-check</code>: If search results appear that aren't part of the test case,
then fail.</li>
<li><code>// ignore-order</code>: Allow search results to appear in any order.</li>
<li><code>// should-fail</code>: Used to write negative tests.</li>
</ul>
<p>Standard library tests usually shouldn't specify <code>// exact-check</code>, since we
want the libs team to be able to add new items without causing unrelated
tests to fail, but standalone tests will use it more often.</p>
<p>The <code>ResultsTable</code> and <code>ParsedQuery</code> types are specified in
<a href="https://github.com/rust-lang/rust/blob/master/src/librustdoc/html/static/js/rustdoc.d.ts"><code>rustdoc.d.ts</code></a>.</p>
<p>For example, imagine we needed to fix a bug where a function named
<code>constructor</code> couldn't be found. To do this, write two files:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// tests/rustdoc-js/constructor_search.rs
// The test case needs to find this result.
pub fn constructor(_input: &amp;str) -&gt; i32 { 1 }
<span class="boring">}
</span></code></pre></pre>
<pre><code class="language-js">// tests/rustdoc-js/constructor_search.js
// exact-check
// Since this test runs against its own crate,
// new items should not appear in the search results.
const EXPECTED = [
  // This first test targets name-based search.
  {
    query: &quot;constructor&quot;,
    others: [
      { path: &quot;constructor_search&quot;, name: &quot;constructor&quot; },
    ],
    in_args: [],
    returned: [],
  },
  // This test targets the second tab.
  {
    query: &quot;str&quot;,
    others: [],
    in_args: [
      { path: &quot;constructor_search&quot;, name: &quot;constructor&quot; },
    ],
    returned: [],
  },
  // This test targets the third tab.
  {
    query: &quot;i32&quot;,
    others: [],
    in_args: [],
    returned: [
      { path: &quot;constructor_search&quot;, name: &quot;constructor&quot; },
    ],
  },
  // This test targets advanced type-driven search.
  {
    query: &quot;str -&gt; i32&quot;,
    others: [
      { path: &quot;constructor_search&quot;, name: &quot;constructor&quot; },
    ],
    in_args: [],
    returned: [],
  },
]
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../rustdoc-internals.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../rustdoc-internals/rustdoc-test-suite.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../rustdoc-internals.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../rustdoc-internals/rustdoc-test-suite.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
