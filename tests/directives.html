<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Test directives - Rust Compiler Development Guide</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A guide to developing the Rust compiler (rustc)">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../getting-started.html">Getting Started</a></li><li class="chapter-item affix "><a href="../about-this-guide.html">About this guide</a></li><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Building and debugging rustc</li><li class="chapter-item "><a href="../building/how-to-build-and-run.html"><strong aria-hidden="true">1.</strong> How to build and run the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../building/quickstart.html"><strong aria-hidden="true">1.1.</strong> Quickstart</a></li><li class="chapter-item "><a href="../building/prerequisites.html"><strong aria-hidden="true">1.2.</strong> Prerequisites</a></li><li class="chapter-item "><a href="../building/suggested.html"><strong aria-hidden="true">1.3.</strong> Suggested Workflows</a></li><li class="chapter-item "><a href="../building/build-install-distribution-artifacts.html"><strong aria-hidden="true">1.4.</strong> Distribution artifacts</a></li><li class="chapter-item "><a href="../building/compiler-documenting.html"><strong aria-hidden="true">1.5.</strong> Building Documentation</a></li><li class="chapter-item "><a href="../rustdoc.html"><strong aria-hidden="true">1.6.</strong> Rustdoc overview</a></li><li class="chapter-item "><a href="../building/new-target.html"><strong aria-hidden="true">1.7.</strong> Adding a new target</a></li><li class="chapter-item "><a href="../building/optimized-build.html"><strong aria-hidden="true">1.8.</strong> Optimized build</a></li></ol></li><li class="chapter-item expanded "><a href="../tests/intro.html"><strong aria-hidden="true">2.</strong> Testing the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/running.html"><strong aria-hidden="true">2.1.</strong> Running tests</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/docker.html"><strong aria-hidden="true">2.1.1.</strong> Testing with Docker</a></li><li class="chapter-item "><a href="../tests/ci.html"><strong aria-hidden="true">2.1.2.</strong> Testing with CI</a></li></ol></li><li class="chapter-item "><a href="../tests/adding.html"><strong aria-hidden="true">2.2.</strong> Adding new tests</a></li><li class="chapter-item "><a href="../tests/best-practices.html"><strong aria-hidden="true">2.3.</strong> Best practices</a></li><li class="chapter-item expanded "><a href="../tests/compiletest.html"><strong aria-hidden="true">2.4.</strong> Compiletest</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/ui.html"><strong aria-hidden="true">2.4.1.</strong> UI tests</a></li><li class="chapter-item expanded "><a href="../tests/directives.html" class="active"><strong aria-hidden="true">2.4.2.</strong> Test directives</a></li><li class="chapter-item "><a href="../tests/minicore.html"><strong aria-hidden="true">2.4.3.</strong> Minicore</a></li></ol></li><li class="chapter-item "><a href="../tests/ecosystem.html"><strong aria-hidden="true">2.5.</strong> Ecosystem testing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/crater.html"><strong aria-hidden="true">2.5.1.</strong> Crater</a></li><li class="chapter-item "><a href="../tests/ecosystem-test-jobs/fuchsia.html"><strong aria-hidden="true">2.5.2.</strong> Fuchsia</a></li><li class="chapter-item "><a href="../tests/ecosystem-test-jobs/rust-for-linux.html"><strong aria-hidden="true">2.5.3.</strong> Rust for Linux</a></li></ol></li><li class="chapter-item "><a href="../tests/codegen-backend-tests/intro.html"><strong aria-hidden="true">2.6.</strong> Codegen backend testing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/codegen-backend-tests/cg_clif.html"><strong aria-hidden="true">2.6.1.</strong> Cranelift codegen backend</a></li><li class="chapter-item "><a href="../tests/codegen-backend-tests/cg_gcc.html"><strong aria-hidden="true">2.6.2.</strong> GCC codegen backend</a></li></ol></li><li class="chapter-item "><a href="../tests/perf.html"><strong aria-hidden="true">2.7.</strong> Performance testing</a></li><li class="chapter-item "><a href="../tests/suggest-tests.html"><strong aria-hidden="true">2.8.</strong> Suggest tests tool</a></li><li class="chapter-item "><a href="../tests/misc.html"><strong aria-hidden="true">2.9.</strong> Misc info</a></li></ol></li><li class="chapter-item "><a href="../compiler-debugging.html"><strong aria-hidden="true">3.</strong> Debugging the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tracing.html"><strong aria-hidden="true">3.1.</strong> Using the tracing/logging instrumentation</a></li></ol></li><li class="chapter-item "><a href="../profiling.html"><strong aria-hidden="true">4.</strong> Profiling the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../profiling/with_perf.html"><strong aria-hidden="true">4.1.</strong> with the linux perf tool</a></li><li class="chapter-item "><a href="../profiling/wpa_profiling.html"><strong aria-hidden="true">4.2.</strong> with Windows Performance Analyzer</a></li><li class="chapter-item "><a href="../profiling/with_rustc_perf.html"><strong aria-hidden="true">4.3.</strong> with the Rust benchmark suite</a></li></ol></li><li class="chapter-item "><a href="../crates-io.html"><strong aria-hidden="true">5.</strong> crates.io Dependencies</a></li><li class="chapter-item affix "><li class="part-title">Contributing to Rust</li><li class="chapter-item "><a href="../contributing.html"><strong aria-hidden="true">6.</strong> Contribution Procedures</a></li><li class="chapter-item "><a href="../compiler-team.html"><strong aria-hidden="true">7.</strong> About the compiler team</a></li><li class="chapter-item "><a href="../git.html"><strong aria-hidden="true">8.</strong> Using Git</a></li><li class="chapter-item "><a href="../rustbot.html"><strong aria-hidden="true">9.</strong> Mastering @rustbot</a></li><li class="chapter-item "><a href="../walkthrough.html"><strong aria-hidden="true">10.</strong> Walkthrough: a typical contribution</a></li><li class="chapter-item "><a href="../implementing_new_features.html"><strong aria-hidden="true">11.</strong> Implementing new language features</a></li><li class="chapter-item "><a href="../stability.html"><strong aria-hidden="true">12.</strong> Stability attributes</a></li><li class="chapter-item "><a href="../stabilization_guide.html"><strong aria-hidden="true">13.</strong> Stabilizing Features</a></li><li class="chapter-item "><a href="../feature-gates.html"><strong aria-hidden="true">14.</strong> Feature Gates</a></li><li class="chapter-item "><a href="../conventions.html"><strong aria-hidden="true">15.</strong> Coding conventions</a></li><li class="chapter-item "><a href="../bug-fix-procedure.html"><strong aria-hidden="true">16.</strong> Procedures for Breaking Changes</a></li><li class="chapter-item "><a href="../external-repos.html"><strong aria-hidden="true">17.</strong> Using external repositories</a></li><li class="chapter-item "><a href="../fuzzing.html"><strong aria-hidden="true">18.</strong> Fuzzing</a></li><li class="chapter-item "><a href="../notification-groups/about.html"><strong aria-hidden="true">19.</strong> Notification groups</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../notification-groups/apple.html"><strong aria-hidden="true">19.1.</strong> Apple</a></li><li class="chapter-item "><a href="../notification-groups/arm.html"><strong aria-hidden="true">19.2.</strong> ARM</a></li><li class="chapter-item "><a href="../notification-groups/cleanup-crew.html"><strong aria-hidden="true">19.3.</strong> Cleanup Crew</a></li><li class="chapter-item "><a href="../notification-groups/emscripten.html"><strong aria-hidden="true">19.4.</strong> Emscripten</a></li><li class="chapter-item "><a href="../notification-groups/fuchsia.html"><strong aria-hidden="true">19.5.</strong> Fuchsia</a></li><li class="chapter-item "><a href="../notification-groups/llvm.html"><strong aria-hidden="true">19.6.</strong> LLVM</a></li><li class="chapter-item "><a href="../notification-groups/risc-v.html"><strong aria-hidden="true">19.7.</strong> RISC-V</a></li><li class="chapter-item "><a href="../notification-groups/rust-for-linux.html"><strong aria-hidden="true">19.8.</strong> Rust for Linux</a></li><li class="chapter-item "><a href="../notification-groups/wasi.html"><strong aria-hidden="true">19.9.</strong> WASI</a></li><li class="chapter-item "><a href="../notification-groups/wasm.html"><strong aria-hidden="true">19.10.</strong> WebAssembly</a></li><li class="chapter-item "><a href="../notification-groups/windows.html"><strong aria-hidden="true">19.11.</strong> Windows</a></li></ol></li><li class="chapter-item "><a href="../licenses.html"><strong aria-hidden="true">20.</strong> Licenses</a></li><li class="chapter-item "><a href="../guides/editions.html"><strong aria-hidden="true">21.</strong> Editions</a></li><li class="chapter-item affix "><li class="part-title">Bootstrapping</li><li class="chapter-item "><a href="../building/bootstrapping/intro.html"><strong aria-hidden="true">22.</strong> Prologue</a></li><li class="chapter-item "><a href="../building/bootstrapping/what-bootstrapping-does.html"><strong aria-hidden="true">23.</strong> What Bootstrapping does</a></li><li class="chapter-item "><a href="../building/bootstrapping/how-bootstrap-does-it.html"><strong aria-hidden="true">24.</strong> How Bootstrap does it</a></li><li class="chapter-item "><a href="../building/bootstrapping/writing-tools-in-bootstrap.html"><strong aria-hidden="true">25.</strong> Writing tools in Bootstrap</a></li><li class="chapter-item "><a href="../building/bootstrapping/debugging-bootstrap.html"><strong aria-hidden="true">26.</strong> Debugging bootstrap</a></li><li class="chapter-item affix "><li class="part-title">High-level Compiler Architecture</li><li class="chapter-item "><a href="../part-2-intro.html"><strong aria-hidden="true">27.</strong> Prologue</a></li><li class="chapter-item "><a href="../overview.html"><strong aria-hidden="true">28.</strong> Overview of the compiler</a></li><li class="chapter-item "><a href="../compiler-src.html"><strong aria-hidden="true">29.</strong> The compiler source code</a></li><li class="chapter-item "><a href="../query.html"><strong aria-hidden="true">30.</strong> Queries: demand-driven compilation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../queries/query-evaluation-model-in-detail.html"><strong aria-hidden="true">30.1.</strong> The Query Evaluation Model in Detail</a></li><li class="chapter-item "><a href="../queries/incremental-compilation.html"><strong aria-hidden="true">30.2.</strong> Incremental compilation</a></li><li class="chapter-item "><a href="../queries/incremental-compilation-in-detail.html"><strong aria-hidden="true">30.3.</strong> Incremental compilation In Detail</a></li><li class="chapter-item "><a href="../incrcomp-debugging.html"><strong aria-hidden="true">30.4.</strong> Debugging and Testing</a></li><li class="chapter-item "><a href="../queries/salsa.html"><strong aria-hidden="true">30.5.</strong> Salsa</a></li></ol></li><li class="chapter-item "><a href="../memory.html"><strong aria-hidden="true">31.</strong> Memory Management in Rustc</a></li><li class="chapter-item "><a href="../serialization.html"><strong aria-hidden="true">32.</strong> Serialization in Rustc</a></li><li class="chapter-item "><a href="../parallel-rustc.html"><strong aria-hidden="true">33.</strong> Parallel Compilation</a></li><li class="chapter-item "><a href="../rustdoc-internals.html"><strong aria-hidden="true">34.</strong> Rustdoc internals</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rustdoc-internals/search.html"><strong aria-hidden="true">34.1.</strong> Search</a></li><li class="chapter-item "><a href="../rustdoc-internals/rustdoc-test-suite.html"><strong aria-hidden="true">34.2.</strong> The rustdoc test suite</a></li></ol></li><li class="chapter-item "><li class="part-title">Source Code Representation</li><li class="chapter-item "><a href="../part-3-intro.html"><strong aria-hidden="true">35.</strong> Prologue</a></li><li class="chapter-item "><a href="../syntax-intro.html"><strong aria-hidden="true">36.</strong> Syntax and the AST</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../the-parser.html"><strong aria-hidden="true">36.1.</strong> Lexing and Parsing</a></li><li class="chapter-item "><a href="../macro-expansion.html"><strong aria-hidden="true">36.2.</strong> Macro expansion</a></li><li class="chapter-item "><a href="../name-resolution.html"><strong aria-hidden="true">36.3.</strong> Name resolution</a></li><li class="chapter-item "><a href="../attributes.html"><strong aria-hidden="true">36.4.</strong> Attributes</a></li><li class="chapter-item "><a href="../test-implementation.html"><strong aria-hidden="true">36.5.</strong> #[test] Implementation</a></li><li class="chapter-item "><a href="../panic-implementation.html"><strong aria-hidden="true">36.6.</strong> Panic Implementation</a></li><li class="chapter-item "><a href="../ast-validation.html"><strong aria-hidden="true">36.7.</strong> AST Validation</a></li><li class="chapter-item "><a href="../feature-gate-ck.html"><strong aria-hidden="true">36.8.</strong> Feature Gate Checking</a></li><li class="chapter-item "><a href="../lang-items.html"><strong aria-hidden="true">36.9.</strong> Lang Items</a></li></ol></li><li class="chapter-item "><a href="../hir.html"><strong aria-hidden="true">37.</strong> The HIR (High-level IR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ast-lowering.html"><strong aria-hidden="true">37.1.</strong> Lowering AST to HIR</a></li><li class="chapter-item "><a href="../hir-debugging.html"><strong aria-hidden="true">37.2.</strong> Debugging</a></li></ol></li><li class="chapter-item "><a href="../thir.html"><strong aria-hidden="true">38.</strong> The THIR (Typed High-level IR)</a></li><li class="chapter-item "><a href="../mir/index.html"><strong aria-hidden="true">39.</strong> The MIR (Mid-level IR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../mir/construction.html"><strong aria-hidden="true">39.1.</strong> MIR construction</a></li><li class="chapter-item "><a href="../mir/visitor.html"><strong aria-hidden="true">39.2.</strong> MIR visitor and traversal</a></li><li class="chapter-item "><a href="../mir/passes.html"><strong aria-hidden="true">39.3.</strong> MIR queries and passes: getting the MIR</a></li></ol></li><li class="chapter-item "><a href="../asm.html"><strong aria-hidden="true">40.</strong> Inline assembly</a></li><li class="chapter-item affix "><li class="part-title">Supporting Infrastructure</li><li class="chapter-item "><a href="../cli.html"><strong aria-hidden="true">41.</strong> Command-line arguments</a></li><li class="chapter-item "><a href="../rustc-driver/intro.html"><strong aria-hidden="true">42.</strong> rustc_driver and rustc_interface</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rustc-driver/interacting-with-the-ast.html"><strong aria-hidden="true">42.1.</strong> Example: Type checking</a></li><li class="chapter-item "><a href="../rustc-driver/getting-diagnostics.html"><strong aria-hidden="true">42.2.</strong> Example: Getting diagnostics</a></li><li class="chapter-item "><a href="../rustc-driver/remarks-on-perma-unstable-features.html"><strong aria-hidden="true">42.3.</strong> Remarks on perma-unstable features</a></li></ol></li><li class="chapter-item "><a href="../diagnostics.html"><strong aria-hidden="true">43.</strong> Errors and Lints</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../diagnostics/diagnostic-structs.html"><strong aria-hidden="true">43.1.</strong> Diagnostic and subdiagnostic structs</a></li><li class="chapter-item "><a href="../diagnostics/translation.html"><strong aria-hidden="true">43.2.</strong> Translation</a></li><li class="chapter-item "><a href="../diagnostics/lintstore.html"><strong aria-hidden="true">43.3.</strong> LintStore</a></li><li class="chapter-item "><a href="../diagnostics/error-codes.html"><strong aria-hidden="true">43.4.</strong> Error codes</a></li><li class="chapter-item "><a href="../diagnostics/diagnostic-items.html"><strong aria-hidden="true">43.5.</strong> Diagnostic items</a></li><li class="chapter-item "><a href="../diagnostics/error-guaranteed.html"><strong aria-hidden="true">43.6.</strong> ErrorGuaranteed</a></li></ol></li><li class="chapter-item "><li class="part-title">Analysis</li><li class="chapter-item "><a href="../part-4-intro.html"><strong aria-hidden="true">44.</strong> Prologue</a></li><li class="chapter-item "><a href="../generic_parameters_summary.html"><strong aria-hidden="true">45.</strong> Generic parameter definitions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ty_module/early_binder.html"><strong aria-hidden="true">45.1.</strong> EarlyBinder and instantiating parameters</a></li></ol></li><li class="chapter-item "><a href="../ty_module/binders.html"><strong aria-hidden="true">46.</strong> Binders and Higher ranked regions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ty_module/instantiating_binders.html"><strong aria-hidden="true">46.1.</strong> Instantiating binders</a></li></ol></li><li class="chapter-item "><a href="../early_late_parameters.html"><strong aria-hidden="true">47.</strong> Early vs Late bound parameters</a></li><li class="chapter-item "><a href="../ty.html"><strong aria-hidden="true">48.</strong> The ty module: representing types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ty_module/generic_arguments.html"><strong aria-hidden="true">48.1.</strong> ADTs and Generic Arguments</a></li><li class="chapter-item "><a href="../ty_module/param_ty_const_regions.html"><strong aria-hidden="true">48.2.</strong> Parameter types/consts/regions</a></li></ol></li><li class="chapter-item "><a href="../ty-fold.html"><strong aria-hidden="true">49.</strong> TypeFolder and TypeFoldable</a></li><li class="chapter-item "><a href="../typing_parameter_envs.html"><strong aria-hidden="true">50.</strong> Typing/Param Envs</a></li><li class="chapter-item "><a href="../type-inference.html"><strong aria-hidden="true">51.</strong> Type inference</a></li><li class="chapter-item "><a href="../traits/resolution.html"><strong aria-hidden="true">52.</strong> Trait solving</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../traits/hrtb.html"><strong aria-hidden="true">52.1.</strong> Higher-ranked trait bounds</a></li><li class="chapter-item "><a href="../traits/caching.html"><strong aria-hidden="true">52.2.</strong> Caching subtleties</a></li><li class="chapter-item "><a href="../traits/implied-bounds.html"><strong aria-hidden="true">52.3.</strong> Implied bounds</a></li><li class="chapter-item "><a href="../traits/specialization.html"><strong aria-hidden="true">52.4.</strong> Specialization</a></li><li class="chapter-item "><a href="../traits/chalk.html"><strong aria-hidden="true">52.5.</strong> Chalk-based trait solving</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../traits/lowering-to-logic.html"><strong aria-hidden="true">52.5.1.</strong> Lowering to logic</a></li><li class="chapter-item "><a href="../traits/goals-and-clauses.html"><strong aria-hidden="true">52.5.2.</strong> Goals and clauses</a></li><li class="chapter-item "><a href="../traits/canonical-queries.html"><strong aria-hidden="true">52.5.3.</strong> Canonical queries</a></li><li class="chapter-item "><a href="../traits/canonicalization.html"><strong aria-hidden="true">52.5.4.</strong> Canonicalization</a></li></ol></li><li class="chapter-item "><a href="../solve/trait-solving.html"><strong aria-hidden="true">52.6.</strong> Next-gen trait solving</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../solve/invariants.html"><strong aria-hidden="true">52.6.1.</strong> Invariants of the type system</a></li><li class="chapter-item "><a href="../solve/the-solver.html"><strong aria-hidden="true">52.6.2.</strong> The solver</a></li><li class="chapter-item "><a href="../solve/canonicalization.html"><strong aria-hidden="true">52.6.3.</strong> Canonicalization</a></li><li class="chapter-item "><a href="../solve/coinduction.html"><strong aria-hidden="true">52.6.4.</strong> Coinduction</a></li><li class="chapter-item "><a href="../solve/caching.html"><strong aria-hidden="true">52.6.5.</strong> Caching</a></li><li class="chapter-item "><a href="../solve/proof-trees.html"><strong aria-hidden="true">52.6.6.</strong> Proof trees</a></li><li class="chapter-item "><a href="../solve/normalization.html"><strong aria-hidden="true">52.6.7.</strong> Normalization</a></li><li class="chapter-item "><a href="../solve/opaque-types.html"><strong aria-hidden="true">52.6.8.</strong> Opaque types</a></li><li class="chapter-item "><a href="../solve/significant-changes.html"><strong aria-hidden="true">52.6.9.</strong> Significant changes and quirks</a></li></ol></li><li class="chapter-item "><a href="../traits/unsize.html"><strong aria-hidden="true">52.7.</strong> Unsize and CoerceUnsized traits</a></li></ol></li><li class="chapter-item "><a href="../type-checking.html"><strong aria-hidden="true">53.</strong> Type checking</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../method-lookup.html"><strong aria-hidden="true">53.1.</strong> Method Lookup</a></li><li class="chapter-item "><a href="../variance.html"><strong aria-hidden="true">53.2.</strong> Variance</a></li><li class="chapter-item "><a href="../coherence.html"><strong aria-hidden="true">53.3.</strong> Coherence Checking</a></li><li class="chapter-item "><a href="../opaque-types-type-alias-impl-trait.html"><strong aria-hidden="true">53.4.</strong> Opaque Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../opaque-types-impl-trait-inference.html"><strong aria-hidden="true">53.4.1.</strong> Inference details</a></li><li class="chapter-item "><a href="../return-position-impl-trait-in-trait.html"><strong aria-hidden="true">53.4.2.</strong> Return Position Impl Trait In Trait</a></li><li class="chapter-item "><a href="../borrow_check/opaque-types-region-inference-restrictions.html"><strong aria-hidden="true">53.4.3.</strong> Region inference restrictions</a></li></ol></li></ol></li><li class="chapter-item "><a href="../effects.html"><strong aria-hidden="true">54.</strong> Const condition checking</a></li><li class="chapter-item "><a href="../pat-exhaustive-checking.html"><strong aria-hidden="true">55.</strong> Pattern and Exhaustiveness Checking</a></li><li class="chapter-item "><a href="../unsafety-checking.html"><strong aria-hidden="true">56.</strong> Unsafety Checking</a></li><li class="chapter-item "><a href="../mir/dataflow.html"><strong aria-hidden="true">57.</strong> MIR dataflow</a></li><li class="chapter-item "><a href="../mir/drop-elaboration.html"><strong aria-hidden="true">58.</strong> Drop elaboration</a></li><li class="chapter-item "><a href="../borrow_check.html"><strong aria-hidden="true">59.</strong> The borrow checker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../borrow_check/moves_and_initialization.html"><strong aria-hidden="true">59.1.</strong> Tracking moves and initialization</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../borrow_check/moves_and_initialization/move_paths.html"><strong aria-hidden="true">59.1.1.</strong> Move paths</a></li></ol></li><li class="chapter-item "><a href="../borrow_check/type_check.html"><strong aria-hidden="true">59.2.</strong> MIR type checker</a></li><li class="chapter-item "><a href="../borrow_check/drop_check.html"><strong aria-hidden="true">59.3.</strong> Drop check</a></li><li class="chapter-item "><a href="../borrow_check/region_inference.html"><strong aria-hidden="true">59.4.</strong> Region inference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../borrow_check/region_inference/constraint_propagation.html"><strong aria-hidden="true">59.4.1.</strong> Constraint propagation</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/lifetime_parameters.html"><strong aria-hidden="true">59.4.2.</strong> Lifetime parameters</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/member_constraints.html"><strong aria-hidden="true">59.4.3.</strong> Member constraints</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/placeholders_and_universes.html"><strong aria-hidden="true">59.4.4.</strong> Placeholders and universes</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/closure_constraints.html"><strong aria-hidden="true">59.4.5.</strong> Closure constraints</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/error_reporting.html"><strong aria-hidden="true">59.4.6.</strong> Error reporting</a></li></ol></li><li class="chapter-item "><a href="../borrow_check/two_phase_borrows.html"><strong aria-hidden="true">59.5.</strong> Two-phase-borrows</a></li></ol></li><li class="chapter-item "><a href="../closure.html"><strong aria-hidden="true">60.</strong> Closure capture inference</a></li><li class="chapter-item "><a href="../coroutine-closures.html"><strong aria-hidden="true">61.</strong> Async closures/"coroutine-closures"</a></li><li class="chapter-item affix "><li class="part-title">MIR to Binaries</li><li class="chapter-item "><a href="../part-5-intro.html"><strong aria-hidden="true">62.</strong> Prologue</a></li><li class="chapter-item "><a href="../mir/optimizations.html"><strong aria-hidden="true">63.</strong> MIR optimizations</a></li><li class="chapter-item "><a href="../mir/debugging.html"><strong aria-hidden="true">64.</strong> Debugging MIR</a></li><li class="chapter-item "><a href="../const-eval.html"><strong aria-hidden="true">65.</strong> Constant evaluation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../const-eval/interpret.html"><strong aria-hidden="true">65.1.</strong> Interpreter</a></li></ol></li><li class="chapter-item "><a href="../backend/monomorph.html"><strong aria-hidden="true">66.</strong> Monomorphization</a></li><li class="chapter-item "><a href="../backend/lowering-mir.html"><strong aria-hidden="true">67.</strong> Lowering MIR</a></li><li class="chapter-item "><a href="../backend/codegen.html"><strong aria-hidden="true">68.</strong> Code Generation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../backend/updating-llvm.html"><strong aria-hidden="true">68.1.</strong> Updating LLVM</a></li><li class="chapter-item "><a href="../backend/debugging.html"><strong aria-hidden="true">68.2.</strong> Debugging LLVM</a></li><li class="chapter-item "><a href="../backend/backend-agnostic.html"><strong aria-hidden="true">68.3.</strong> Backend Agnostic Codegen</a></li><li class="chapter-item "><a href="../backend/implicit-caller-location.html"><strong aria-hidden="true">68.4.</strong> Implicit Caller Location</a></li></ol></li><li class="chapter-item "><a href="../backend/libs-and-metadata.html"><strong aria-hidden="true">69.</strong> Libraries and Metadata</a></li><li class="chapter-item "><a href="../profile-guided-optimization.html"><strong aria-hidden="true">70.</strong> Profile-guided Optimization</a></li><li class="chapter-item "><a href="../llvm-coverage-instrumentation.html"><strong aria-hidden="true">71.</strong> LLVM Source-Based Code Coverage</a></li><li class="chapter-item "><a href="../sanitizers.html"><strong aria-hidden="true">72.</strong> Sanitizers Support</a></li><li class="chapter-item "><a href="../debugging-support-in-rustc.html"><strong aria-hidden="true">73.</strong> Debugging support in the Rust compiler</a></li><li class="spacer"></li><li class="chapter-item affix "><a href="../appendix/background.html">Appendix A: Background topics</a></li><li class="chapter-item affix "><a href="../appendix/glossary.html">Appendix B: Glossary</a></li><li class="chapter-item affix "><a href="../appendix/code-index.html">Appendix C: Code Index</a></li><li class="chapter-item affix "><a href="../appendix/compiler-lecture.html">Appendix D: Compiler Lecture Series</a></li><li class="chapter-item affix "><a href="../appendix/bibliography.html">Appendix E: Bibliography</a></li><li class="chapter-item affix "><a href="../appendix/humorust.html">Appendix Z: HumorRust</a></li><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Compiler Development Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rustc-dev-guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rustc-dev-guide/edit/master/src/tests/directives.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="compiletest-directives"><a class="header" href="#compiletest-directives">Compiletest directives</a></h1>
<ul>
<li><a href="#listing-of-compiletest-directives">Listing of compiletest directives</a>
<ul>
<li><a href="#assembly">Assembly</a></li>
<li><a href="#auxiliary-builds">Auxiliary builds</a></li>
<li><a href="#controlling-outcome-expectations">Controlling outcome expectations</a></li>
<li><a href="#controlling-output-snapshots-and-normalizations">Controlling output snapshots and normalizations</a></li>
<li><a href="#controlling-when-tests-are-run">Controlling when tests are run</a></li>
<li><a href="#affecting-how-tests-are-built">Affecting how tests are built</a></li>
<li><a href="#rustdoc">Rustdoc</a></li>
<li><a href="#pretty-printing">Pretty printing</a>
<ul>
<li><a href="#misc-directives">Misc directives</a></li>
</ul>
</li>
<li><a href="#tool-specific-directives">Tool-specific directives</a></li>
</ul>
</li>
<li><a href="#substitutions">Substitutions</a></li>
<li><a href="#adding-a-directive">Adding a directive</a>
<ul>
<li><a href="#adding-a-new-directive-parser">Adding a new directive parser</a></li>
<li><a href="#implementing-the-behavior-change">Implementing the behavior change</a></li>
</ul>
</li>
</ul>
<!--
FIXME(jieyouxu) completely revise this chapter.
-->
<p>Directives are special comments that tell compiletest how to build and interpret a test.
They may also appear in <code>rmake.rs</code> <a href="compiletest.html#run-make-tests">run-make tests</a>.</p>
<p>They are normally put after the short comment that explains the point of this
test. Compiletest test suites use <code>//@</code> to signal that a comment is a directive.
For example, this test uses the <code>//@ compile-flags</code> command to specify a custom
flag to give to rustc when the test is compiled:</p>
<pre><code class="language-rust ignore">// Test the behavior of `0 - 1` when overflow checks are disabled.

//@ compile-flags: -C overflow-checks=off

fn main() {
    let x = 0 - 1;
    ...
}
</code></pre>
<p>Directives can be standalone (like <code>//@ run-pass</code>) or take a value (like <code>//@ compile-flags: -C overflow-checks=off</code>).</p>
<p>Directives are written one directive per line: you cannot write multiple
directives on the same line. For example, if you write <code>//@ only-x86 only-windows</code> then <code>only-windows</code> is interpreted as a comment, not a separate
directive.</p>
<h2 id="listing-of-compiletest-directives"><a class="header" href="#listing-of-compiletest-directives">Listing of compiletest directives</a></h2>
<p>The following is a list of compiletest directives. Directives are linked to
sections that describe the command in more detail if available. This list may
not be exhaustive. Directives can generally be found by browsing the
<code>TestProps</code> structure found in <a href="https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/header.rs"><code>header.rs</code></a> from the compiletest source.</p>
<h3 id="assembly"><a class="header" href="#assembly">Assembly</a></h3>
<!-- date-check: Oct 2024 -->
<div class="table-wrapper"><table><thead><tr><th>Directive</th><th>Explanation</th><th>Supported test suites</th><th>Possible values</th></tr></thead><tbody>
<tr><td><code>assembly-output</code></td><td>Assembly output kind to check</td><td><code>assembly</code></td><td><code>emit-asm</code>, <code>bpf-linker</code>, <code>ptx-linker</code></td></tr>
</tbody></table>
</div>
<h3 id="auxiliary-builds"><a class="header" href="#auxiliary-builds">Auxiliary builds</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Directive</th><th>Explanation</th><th>Supported test suites</th><th>Possible values</th></tr></thead><tbody>
<tr><td><code>aux-bin</code></td><td>Build a aux binary, made available in <code>auxiliary/bin</code> relative to test directory</td><td>All except <code>run-make</code></td><td>Path to auxiliary <code>.rs</code> file</td></tr>
<tr><td><code>aux-build</code></td><td>Build a separate crate from the named source file</td><td>All except <code>run-make</code></td><td>Path to auxiliary <code>.rs</code> file</td></tr>
<tr><td><code>aux-crate</code></td><td>Like <code>aux-build</code> but makes available as extern prelude</td><td>All except <code>run-make</code></td><td><code>&lt;extern_prelude_name&gt;=&lt;path/to/aux/file.rs&gt;</code></td></tr>
<tr><td><code>aux-codegen-backend</code></td><td>Similar to <code>aux-build</code> but pass the compiled dylib to <code>-Zcodegen-backend</code> when building the main file</td><td><code>ui-fulldeps</code></td><td>Path to codegen backend file</td></tr>
<tr><td><code>proc-macro</code></td><td>Similar to <code>aux-build</code>, but for aux forces host and don't use <code>-Cprefer-dynamic</code><sup class="footnote-reference"><a href="#pm">1</a></sup>.</td><td>All except <code>run-make</code></td><td>Path to auxiliary proc-macro <code>.rs</code> file</td></tr>
<tr><td><code>build_aux_docs</code></td><td>Build docs for auxiliaries as well</td><td>All except <code>run-make</code></td><td>N/A</td></tr>
</tbody></table>
</div>
<div class="footnote-definition" id="pm"><sup class="footnote-definition-label">1</sup>
<p>please see the Auxiliary proc-macro section in the
<a href="./compiletest.html">compiletest</a> chapter for specifics.</p>
</div>
<h3 id="controlling-outcome-expectations"><a class="header" href="#controlling-outcome-expectations">Controlling outcome expectations</a></h3>
<p>See <a href="ui.html#controlling-passfail-expectations">Controlling pass/fail
expectations</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Directive</th><th>Explanation</th><th>Supported test suites</th><th>Possible values</th></tr></thead><tbody>
<tr><td><code>check-pass</code></td><td>Building (no codegen) should pass</td><td><code>ui</code>, <code>crashes</code>, <code>incremental</code></td><td>N/A</td></tr>
<tr><td><code>check-fail</code></td><td>Building (no codegen) should fail</td><td><code>ui</code>, <code>crashes</code></td><td>N/A</td></tr>
<tr><td><code>build-pass</code></td><td>Building should pass</td><td><code>ui</code>, <code>crashes</code>, <code>codegen</code>, <code>incremental</code></td><td>N/A</td></tr>
<tr><td><code>build-fail</code></td><td>Building should fail</td><td><code>ui</code>, <code>crashes</code></td><td>N/A</td></tr>
<tr><td><code>run-pass</code></td><td>Running the test binary should pass</td><td><code>ui</code>, <code>crashes</code>, <code>incremental</code></td><td>N/A</td></tr>
<tr><td><code>run-fail</code></td><td>Running the test binary should fail</td><td><code>ui</code>, <code>crashes</code></td><td>N/A</td></tr>
<tr><td><code>ignore-pass</code></td><td>Ignore <code>--pass</code> flag</td><td><code>ui</code>, <code>crashes</code>, <code>codegen</code>, <code>incremental</code></td><td>N/A</td></tr>
<tr><td><code>dont-check-failure-status</code></td><td>Don't check exact failure status (i.e. <code>1</code>)</td><td><code>ui</code>, <code>incremental</code></td><td>N/A</td></tr>
<tr><td><code>failure-status</code></td><td>Check</td><td><code>ui</code>, <code>crashes</code></td><td>Any <code>u16</code></td></tr>
<tr><td><code>should-ice</code></td><td>Check failure status is <code>101</code></td><td><code>coverage</code>, <code>incremental</code></td><td>N/A</td></tr>
<tr><td><code>should-fail</code></td><td>Compiletest self-test</td><td>All</td><td>N/A</td></tr>
</tbody></table>
</div>
<h3 id="controlling-output-snapshots-and-normalizations"><a class="header" href="#controlling-output-snapshots-and-normalizations">Controlling output snapshots and normalizations</a></h3>
<p>See <a href="ui.html#normalization">Normalization</a>, <a href="ui.html#output-comparison">Output
comparison</a> and <a href="ui.html#rustfix-tests">Rustfix tests</a>
for more details.</p>
<div class="table-wrapper"><table><thead><tr><th>Directive</th><th>Explanation</th><th>Supported test suites</th><th>Possible values</th></tr></thead><tbody>
<tr><td><code>check-run-results</code></td><td>Check run test binary <code>run-{pass,fail}</code> output snapshot</td><td><code>ui</code>, <code>crashes</code>, <code>incremental</code> if <code>run-pass</code></td><td>N/A</td></tr>
<tr><td><code>error-pattern</code></td><td>Check that output contains a specific string</td><td><code>ui</code>, <code>crashes</code>, <code>incremental</code> if <code>run-pass</code></td><td>String</td></tr>
<tr><td><code>regex-error-pattern</code></td><td>Check that output contains a regex pattern</td><td><code>ui</code>, <code>crashes</code>, <code>incremental</code> if <code>run-pass</code></td><td>Regex</td></tr>
<tr><td><code>check-stdout</code></td><td>Check <code>stdout</code> against <code>error-pattern</code>s from running test binary<sup class="footnote-reference"><a href="#check_stdout">2</a></sup></td><td><code>ui</code>, <code>crashes</code>, <code>incremental</code></td><td>N/A</td></tr>
<tr><td><code>normalize-stderr-32bit</code></td><td>Normalize actual stderr (for 32-bit platforms) with a rule <code>&quot;&lt;raw&gt;&quot; -&gt; &quot;&lt;normalized&gt;&quot;</code> before comparing against snapshot</td><td><code>ui</code>, <code>incremental</code></td><td><code>&quot;&lt;RAW&gt;&quot; -&gt; &quot;&lt;NORMALIZED&gt;&quot;</code>, <code>&lt;RAW&gt;</code>/<code>&lt;NORMALIZED&gt;</code> is regex capture and replace syntax</td></tr>
<tr><td><code>normalize-stderr-64bit</code></td><td>Normalize actual stderr (for 64-bit platforms) with a rule <code>&quot;&lt;raw&gt;&quot; -&gt; &quot;&lt;normalized&gt;&quot;</code> before comparing against snapshot</td><td><code>ui</code>, <code>incremental</code></td><td><code>&quot;&lt;RAW&gt;&quot; -&gt; &quot;&lt;NORMALIZED&gt;&quot;</code>, <code>&lt;RAW&gt;</code>/<code>&lt;NORMALIZED&gt;</code> is regex capture and replace syntax</td></tr>
<tr><td><code>normalize-stderr</code></td><td>Normalize actual stderr with a rule <code>&quot;&lt;raw&gt;&quot; -&gt; &quot;&lt;normalized&gt;&quot;</code> before comparing against snapshot</td><td><code>ui</code>, <code>incremental</code></td><td><code>&quot;&lt;RAW&gt;&quot; -&gt; &quot;&lt;NORMALIZED&gt;&quot;</code>, <code>&lt;RAW&gt;</code>/<code>&lt;NORMALIZED&gt;</code> is regex capture and replace syntax</td></tr>
<tr><td><code>normalize-stdout</code></td><td>Normalize actual stdout with a rule <code>&quot;&lt;raw&gt;&quot; -&gt; &quot;&lt;normalized&gt;&quot;</code> before comparing against snapshot</td><td><code>ui</code>, <code>incremental</code></td><td><code>&quot;&lt;RAW&gt;&quot; -&gt; &quot;&lt;NORMALIZED&gt;&quot;</code>, <code>&lt;RAW&gt;</code>/<code>&lt;NORMALIZED&gt;</code> is regex capture and replace syntax</td></tr>
<tr><td><code>dont-check-compiler-stderr</code></td><td>Don't check actual compiler stderr vs stderr snapshot</td><td><code>ui</code></td><td>N/A</td></tr>
<tr><td><code>dont-check-compiler-stdout</code></td><td>Don't check actual compiler stdout vs stdout snapshot</td><td><code>ui</code></td><td>N/A</td></tr>
<tr><td><code>run-rustfix</code></td><td>Apply all suggestions via <code>rustfix</code>, snapshot fixed output, and check fixed output builds</td><td><code>ui</code></td><td>N/A</td></tr>
<tr><td><code>rustfix-only-machine-applicable</code></td><td><code>run-rustfix</code> but only machine-applicable suggestions</td><td><code>ui</code></td><td>N/A</td></tr>
<tr><td><code>exec-env</code></td><td>Env var to set when executing a test</td><td><code>ui</code>, <code>crashes</code></td><td><code>&lt;KEY&gt;=&lt;VALUE&gt;</code></td></tr>
<tr><td><code>unset-exec-env</code></td><td>Env var to unset when executing a test</td><td><code>ui</code>, <code>crashes</code></td><td>Any env var name</td></tr>
<tr><td><code>stderr-per-bitwidth</code></td><td>Generate a stderr snapshot for each bitwidth</td><td><code>ui</code></td><td>N/A</td></tr>
<tr><td><code>forbid-output</code></td><td>A pattern which must not appear in stderr/<code>cfail</code> output</td><td><code>ui</code>, <code>incremental</code></td><td>Regex pattern</td></tr>
<tr><td><code>run-flags</code></td><td>Flags passed to the test executable</td><td><code>ui</code></td><td>Arbitrary flags</td></tr>
<tr><td><code>known-bug</code></td><td>No error annotation needed due to known bug</td><td><code>ui</code>, <code>crashes</code>, <code>incremental</code></td><td>Issue number <code>#123456</code></td></tr>
</tbody></table>
</div>
<div class="footnote-definition" id="check_stdout"><sup class="footnote-definition-label">2</sup>
<p>presently <!-- date-check: Oct 2024 --> this has a weird quirk
where the test binary's stdout and stderr gets concatenated and then
<code>error-pattern</code>s are matched on this combined output, which is ??? slightly
questionable to say the least.</p>
</div>
<h3 id="controlling-when-tests-are-run"><a class="header" href="#controlling-when-tests-are-run">Controlling when tests are run</a></h3>
<p>These directives are used to ignore the test in some situations, which
means the test won't be compiled or run.</p>
<ul>
<li><code>ignore-X</code> where <code>X</code> is a target detail or other criteria on which to ignore the test (see below)</li>
<li><code>only-X</code> is like <code>ignore-X</code>, but will <em>only</em> run the test on that target or
stage</li>
<li><code>ignore-test</code> always ignores the test. This can be used to temporarily disable
a test if it is currently not working, but you want to keep it in tree to
re-enable it later.</li>
</ul>
<p>Some examples of <code>X</code> in <code>ignore-X</code> or <code>only-X</code>:</p>
<ul>
<li>A full target triple: <code>aarch64-apple-ios</code></li>
<li>Architecture: <code>aarch64</code>, <code>arm</code>, <code>mips</code>, <code>wasm32</code>, <code>x86_64</code>, <code>x86</code>,
...</li>
<li>OS: <code>android</code>, <code>emscripten</code>, <code>freebsd</code>, <code>ios</code>, <code>linux</code>, <code>macos</code>, <code>windows</code>,
...</li>
<li>Environment (fourth word of the target triple): <code>gnu</code>, <code>msvc</code>, <code>musl</code></li>
<li>WASM: <code>wasm32-bare</code> matches <code>wasm32-unknown-unknown</code>. <code>emscripten</code> also
matches that target as well as the emscripten targets.</li>
<li>Pointer width: <code>32bit</code>, <code>64bit</code></li>
<li>Endianness: <code>endian-big</code></li>
<li>Stage: <code>stage1</code>, <code>stage2</code></li>
<li>Binary format: <code>elf</code></li>
<li>Channel: <code>stable</code>, <code>beta</code></li>
<li>When cross compiling: <code>cross-compile</code></li>
<li>When <a href="running.html#running-tests-on-a-remote-machine">remote testing</a> is used: <code>remote</code></li>
<li>When particular debuggers are being tested: <code>cdb</code>, <code>gdb</code>, <code>lldb</code></li>
<li>When particular debugger versions are matched: <code>ignore-gdb-version</code></li>
<li>Specific <a href="ui.html#compare-modes">compare modes</a>: <code>compare-mode-polonius</code>, <code>compare-mode-chalk</code>,
<code>compare-mode-split-dwarf</code>, <code>compare-mode-split-dwarf-single</code></li>
<li>The two different test modes used by coverage tests:
<code>ignore-coverage-map</code>, <code>ignore-coverage-run</code></li>
<li>When testing a dist toolchain: <code>dist</code>
<ul>
<li>This needs to be enabled with <code>COMPILETEST_ENABLE_DIST_TESTS=1</code></li>
</ul>
</li>
<li>The <code>rustc_abi</code> of the target: e.g. <code>rustc_abi-x86_64-sse2</code></li>
</ul>
<p>The following directives will check rustc build settings and target
settings:</p>
<ul>
<li><code>needs-asm-support</code> — ignores if it is running on a target that doesn't have
stable support for <code>asm!</code></li>
<li><code>needs-profiler-runtime</code> — ignores the test if the profiler runtime was not
enabled for the target
(<code>build.profiler = true</code> in rustc's <code>bootstrap.toml</code>)</li>
<li><code>needs-sanitizer-support</code> — ignores if the sanitizer support was not enabled
for the target (<code>sanitizers = true</code> in rustc's <code>bootstrap.toml</code>)</li>
<li><code>needs-sanitizer-{address,hwaddress,leak,memory,thread}</code> — ignores if the
corresponding sanitizer is not enabled for the target (AddressSanitizer,
hardware-assisted AddressSanitizer, LeakSanitizer, MemorySanitizer or
ThreadSanitizer respectively)</li>
<li><code>needs-run-enabled</code> — ignores if it is a test that gets executed, and running
has been disabled. Running tests can be disabled with the <code>x test --run=never</code>
flag, or running on fuchsia.</li>
<li><code>needs-unwind</code> — ignores if the target does not support unwinding</li>
<li><code>needs-rust-lld</code> — ignores if the rust lld support is not enabled (<code>rust.lld = true</code> in <code>bootstrap.toml</code>)</li>
<li><code>needs-threads</code> — ignores if the target does not have threading support</li>
<li><code>needs-subprocess</code>  — ignores if the target does not have subprocess support</li>
<li><code>needs-symlink</code> — ignores if the target does not support symlinks. This can be
the case on Windows if the developer did not enable privileged symlink
permissions.</li>
<li><code>ignore-std-debug-assertions</code> — ignores if std was built with debug
assertions.</li>
<li><code>needs-std-debug-assertions</code> — ignores if std was not built with debug
assertions.</li>
<li><code>ignore-rustc-debug-assertions</code> — ignores if rustc was built with debug
assertions.</li>
<li><code>needs-rustc-debug-assertions</code> — ignores if rustc was not built with debug
assertions.</li>
<li><code>needs-target-has-atomic</code> — ignores if target does not have support for all
specified atomic widths, e.g. the test with <code>//@ needs-target-has-atomic: 8, 16, ptr</code> will only run if it supports the comma-separated list of atomic
widths.</li>
<li><code>needs-dynamic-linking</code> - ignores if target does not support dynamic linking
(which is orthogonal to it being unable to create <code>dylib</code> and <code>cdylib</code> crate types)</li>
</ul>
<p>The following directives will check LLVM support:</p>
<ul>
<li><code>exact-llvm-major-version: 19</code> — ignores if the llvm major version does not
match the specified llvm major version.</li>
<li><code>min-llvm-version: 13.0</code> — ignored if the LLVM version is less than the given
value</li>
<li><code>min-system-llvm-version: 12.0</code> — ignored if using a system LLVM and its
version is less than the given value</li>
<li><code>max-llvm-major-version: 19</code> — ignored if the LLVM major version is higher
than the given major version</li>
<li><code>ignore-llvm-version: 9.0</code> — ignores a specific LLVM version</li>
<li><code>ignore-llvm-version: 7.0 - 9.9.9</code> — ignores LLVM versions in a range
(inclusive)</li>
<li><code>needs-llvm-components: powerpc</code> — ignores if the specific LLVM component was
not built. Note: The test will fail on CI (when
<code>COMPILETEST_REQUIRE_ALL_LLVM_COMPONENTS</code> is set) if the component does not
exist.</li>
<li><code>needs-forced-clang-based-tests</code> — test is ignored unless the environment
variable <code>RUSTBUILD_FORCE_CLANG_BASED_TESTS</code> is set, which enables building
clang alongside LLVM
<ul>
<li>This is only set in two CI jobs (<a href="https://github.com/rust-lang/rust/blob/ab3dba92db355b8d97db915a2dca161a117e959c/src/ci/docker/host-x86_64/x86_64-gnu-debug/Dockerfile#L32"><code>x86_64-gnu-debug</code></a> and
<a href="https://github.com/rust-lang/rust/blob/20c909ff9cdd88d33768a4ddb8952927a675b0ad/src/ci/docker/host-aarch64/aarch64-gnu-debug/Dockerfile#L32"><code>aarch64-gnu-debug</code></a>), which only runs a
subset of <code>run-make</code> tests. Other tests with this directive will not
run at all, which is usually not what you want.</li>
</ul>
</li>
</ul>
<p>See also <a href="compiletest.html#debuginfo-tests">Debuginfo tests</a> for directives for
ignoring debuggers.</p>
<h3 id="affecting-how-tests-are-built"><a class="header" href="#affecting-how-tests-are-built">Affecting how tests are built</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Directive</th><th>Explanation</th><th>Supported test suites</th><th>Possible values</th></tr></thead><tbody>
<tr><td><code>compile-flags</code></td><td>Flags passed to <code>rustc</code> when building the test or aux file</td><td>All except for <code>run-make</code></td><td>Any valid <code>rustc</code> flags, e.g. <code>-Awarnings -Dfoo</code>. Cannot be <code>-Cincremental</code>.</td></tr>
<tr><td><code>edition</code></td><td>Alias for <code>compile-flags: --edition=xxx</code></td><td>All except for <code>run-make</code></td><td>Any valid <code>--edition</code> value</td></tr>
<tr><td><code>rustc-env</code></td><td>Env var to set when running <code>rustc</code></td><td>All except for <code>run-make</code></td><td><code>&lt;KEY&gt;=&lt;VALUE&gt;</code></td></tr>
<tr><td><code>unset-rustc-env</code></td><td>Env var to unset when running <code>rustc</code></td><td>All except for <code>run-make</code></td><td>Any env var name</td></tr>
<tr><td><code>incremental</code></td><td>Proper incremental support for tests outside of incremental test suite</td><td><code>ui</code>, <code>crashes</code></td><td>N/A</td></tr>
<tr><td><code>no-prefer-dynamic</code></td><td>Don't use <code>-C prefer-dynamic</code>, don't build as a dylib via a <code>--crate-type=dylib</code> preset flag</td><td><code>ui</code>, <code>crashes</code></td><td>N/A</td></tr>
</tbody></table>
</div><div class="warning">
Tests (outside of `run-make`) that want to use incremental tests not in the
incremental test-suite must not pass `-C incremental` via `compile-flags`, and
must instead use the `//@ incremental` directive.
<p>Consider writing the test as a proper incremental test instead.</p>
</div>
<h3 id="rustdoc"><a class="header" href="#rustdoc">Rustdoc</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Directive</th><th>Explanation</th><th>Supported test suites</th><th>Possible values</th></tr></thead><tbody>
<tr><td><code>doc-flags</code></td><td>Flags passed to <code>rustdoc</code> when building the test or aux file</td><td><code>rustdoc</code>, <code>rustdoc-js</code>, <code>rustdoc-json</code></td><td>Any valid <code>rustdoc</code> flags</td></tr>
</tbody></table>
</div><!--
**FIXME(rustdoc)**: what does `check-test-line-numbers-match` do?
Asked in
<https://rust-lang.zulipchat.com/#narrow/stream/266220-t-rustdoc/topic/What.20is.20the.20.60check-test-line-numbers-match.60.20directive.3F>.
-->
<h3 id="pretty-printing"><a class="header" href="#pretty-printing">Pretty printing</a></h3>
<p>See <a href="compiletest.html#pretty-printer-tests">Pretty-printer</a>.</p>
<h4 id="misc-directives"><a class="header" href="#misc-directives">Misc directives</a></h4>
<ul>
<li><code>no-auto-check-cfg</code> — disable auto check-cfg (only for <code>--check-cfg</code> tests)</li>
<li><a href="compiletest.html#revisions"><code>revisions</code></a> — compile multiple times</li>
<li><a href="compiletest.html#ignoring-unused-revision-names"><code>unused-revision-names</code></a> -
suppress tidy checks for mentioning unknown revision names
-<a href="compiletest.html#incremental-tests"><code>forbid-output</code></a> — incremental cfail rejects
output pattern</li>
<li><a href="compiletest.html#incremental-tests"><code>should-ice</code></a> — incremental cfail should
ICE</li>
<li><a href="https://github.com/rust-lang/reference/blob/master/docs/authoring.md#test-rule-annotations"><code>reference</code></a> — an annotation linking to a rule in the reference</li>
</ul>
<h3 id="tool-specific-directives"><a class="header" href="#tool-specific-directives">Tool-specific directives</a></h3>
<p>The following directives affect how certain command-line tools are invoked, in
test suites that use those tools:</p>
<ul>
<li><code>filecheck-flags</code> adds extra flags when running LLVM's <code>FileCheck</code> tool.
<ul>
<li>Used by <a href="compiletest.html#codegen-tests">codegen tests</a>,
<a href="compiletest.html#assembly-tests">assembly tests</a>, and
<a href="compiletest.html#mir-opt-tests">MIR-opt tests</a>.</li>
</ul>
</li>
<li><code>llvm-cov-flags</code> adds extra flags when running LLVM's <code>llvm-cov</code> tool.
<ul>
<li>Used by <a href="compiletest.html#coverage-tests">coverage tests</a> in <code>coverage-run</code> mode.</li>
</ul>
</li>
</ul>
<h2 id="substitutions"><a class="header" href="#substitutions">Substitutions</a></h2>
<p>Directive values support substituting a few variables which will be replaced
with their corresponding value. For example, if you need to pass a compiler flag
with a path to a specific file, something like the following could work:</p>
<pre><code class="language-rust ignore">//@ compile-flags: --remap-path-prefix={{src-base}}=/the/src
</code></pre>
<p>Where the sentinel <code>{{src-base}}</code> will be replaced with the appropriate path
described below:</p>
<ul>
<li><code>{{cwd}}</code>: The directory where compiletest is run from. This may not be the
root of the checkout, so you should avoid using it where possible.
<ul>
<li>Examples: <code>/path/to/rust</code>, <code>/path/to/build/root</code></li>
</ul>
</li>
<li><code>{{src-base}}</code>: The directory where the test is defined. This is equivalent to
<code>$DIR</code> for <a href="ui.html#normalization">output normalization</a>.
<ul>
<li>Example: <code>/path/to/rust/tests/ui/error-codes</code></li>
</ul>
</li>
<li><code>{{build-base}}</code>: The base directory where the test's output goes. This is
equivalent to <code>$TEST_BUILD_DIR</code> for <a href="ui.html#normalization">output normalization</a>.
<ul>
<li>Example: <code>/path/to/rust/build/x86_64-unknown-linux-gnu/test/ui</code></li>
</ul>
</li>
<li><code>{{rust-src-base}}</code>: The sysroot directory where libstd/libcore/... are
located</li>
<li><code>{{sysroot-base}}</code>: Path of the sysroot directory used to build the test.
<ul>
<li>Mainly intended for <code>ui-fulldeps</code> tests that run the compiler via API.</li>
</ul>
</li>
<li><code>{{target-linker}}</code>: Linker that would be passed to <code>-Clinker</code> for this test,
or blank if no linker override is active.
<ul>
<li>Mainly intended for <code>ui-fulldeps</code> tests that run the compiler via API.</li>
</ul>
</li>
<li><code>{{target}}</code>: The target the test is compiling for
<ul>
<li>Example: <code>x86_64-unknown-linux-gnu</code></li>
</ul>
</li>
</ul>
<p>See
<a href="https://github.com/rust-lang/rust/blob/master/tests/ui/argfile/commandline-argfile.rs"><code>tests/ui/commandline-argfile.rs</code></a>
for an example of a test that uses this substitution.</p>
<h2 id="adding-a-directive"><a class="header" href="#adding-a-directive">Adding a directive</a></h2>
<p>One would add a new directive if there is a need to define some test property or
behavior on an individual, test-by-test basis. A directive property serves as
the directive's backing store (holds the command's current value) at runtime.</p>
<p>To add a new directive property:</p>
<ol>
<li>Look for the <code>pub struct TestProps</code> declaration in
<a href="https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/header.rs"><code>src/tools/compiletest/src/header.rs</code></a> and add the new public property to
the end of the declaration.</li>
<li>Look for the <code>impl TestProps</code> implementation block immediately following the
struct declaration and initialize the new property to its default value.</li>
</ol>
<h3 id="adding-a-new-directive-parser"><a class="header" href="#adding-a-new-directive-parser">Adding a new directive parser</a></h3>
<p>When <code>compiletest</code> encounters a test file, it parses the file a line at a time
by calling every parser defined in the <code>Config</code> struct's implementation block,
also in <a href="https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/header.rs"><code>src/tools/compiletest/src/header.rs</code></a> (note that the <code>Config</code> struct's
declaration block is found in <a href="https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/common.rs"><code>src/tools/compiletest/src/common.rs</code></a>).
<code>TestProps</code>'s <code>load_from()</code> method will try passing the current line of text to
each parser, which, in turn typically checks to see if the line begins with a
particular commented (<code>//@</code>) directive such as <code>//@ must-compile-successfully</code>
or <code>//@ failure-status</code>. Whitespace after the comment marker is optional.</p>
<p>Parsers will override a given directive property's default value merely by being
specified in the test file as a directive or by having a parameter value
specified in the test file, depending on the directive.</p>
<p>Parsers defined in <code>impl Config</code> are typically named <code>parse_&lt;directive-name&gt;</code>
(note kebab-case <code>&lt;directive-command&gt;</code> transformed to snake-case
<code>&lt;directive_command&gt;</code>). <code>impl Config</code> also defines several 'low-level' parsers
which make it simple to parse common patterns like simple presence or not
(<code>parse_name_directive()</code>), <code>directive:parameter(s)</code>
(<code>parse_name_value_directive()</code>), optional parsing only if a particular <code>cfg</code>
attribute is defined (<code>has_cfg_prefix()</code>) and many more. The low-level parsers
are found near the end of the <code>impl Config</code> block; be sure to look through them
and their associated parsers immediately above to see how they are used to avoid
writing additional parsing code unnecessarily.</p>
<p>As a concrete example, here is the implementation for the
<code>parse_failure_status()</code> parser, in <a href="https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/header.rs"><code>src/tools/compiletest/src/header.rs</code></a>:</p>
<pre><code class="language-diff">@@ -232,6 +232,7 @@ pub struct TestProps {
     // customized normalization rules
     pub normalize_stdout: Vec&lt;(String, String)&gt;,
     pub normalize_stderr: Vec&lt;(String, String)&gt;,
+    pub failure_status: i32,
 }

 impl TestProps {
@@ -260,6 +261,7 @@ impl TestProps {
             run_pass: false,
             normalize_stdout: vec![],
             normalize_stderr: vec![],
+            failure_status: 101,
         }
     }

@@ -383,6 +385,10 @@ impl TestProps {
             if let Some(rule) = config.parse_custom_normalization(ln, &quot;normalize-stderr&quot;) {
                 self.normalize_stderr.push(rule);
             }
+
+            if let Some(code) = config.parse_failure_status(ln) {
+                self.failure_status = code;
+            }
         });

         for key in &amp;[&quot;RUST_TEST_NOCAPTURE&quot;, &quot;RUST_TEST_THREADS&quot;] {
@@ -488,6 +494,13 @@ impl Config {
         self.parse_name_directive(line, &quot;pretty-compare-only&quot;)
     }

+    fn parse_failure_status(&amp;self, line: &amp;str) -&gt; Option&lt;i32&gt; {
+        match self.parse_name_value_directive(line, &quot;failure-status&quot;) {
+            Some(code) =&gt; code.trim().parse::&lt;i32&gt;().ok(),
+            _ =&gt; None,
+        }
+    }
</code></pre>
<h3 id="implementing-the-behavior-change"><a class="header" href="#implementing-the-behavior-change">Implementing the behavior change</a></h3>
<p>When a test invokes a particular directive, it is expected that some behavior
will change as a result. What behavior, obviously, will depend on the purpose of
the directive. In the case of <code>failure-status</code>, the behavior that changes is
that <code>compiletest</code> expects the failure code defined by the directive invoked in
the test, rather than the default value.</p>
<p>Although specific to <code>failure-status</code> (as every directive will have a different
implementation in order to invoke behavior change) perhaps it is helpful to see
the behavior change implementation of one case, simply as an example. To
implement <code>failure-status</code>, the <code>check_correct_failure_status()</code> function found
in the <code>TestCx</code> implementation block, located in
<a href="https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/runtest.rs"><code>src/tools/compiletest/src/runtest.rs</code></a>, was modified as per below:</p>
<pre><code class="language-diff">@@ -295,11 +295,14 @@ impl&lt;'test&gt; TestCx&lt;'test&gt; {
     }

     fn check_correct_failure_status(&amp;self, proc_res: &amp;ProcRes) {
-        // The value the Rust runtime returns on failure
-        const RUST_ERR: i32 = 101;
-        if proc_res.status.code() != Some(RUST_ERR) {
+        let expected_status = Some(self.props.failure_status);
+        let received_status = proc_res.status.code();
+
+        if expected_status != received_status {
             self.fatal_proc_rec(
-                &amp;format!(&quot;failure produced the wrong error: {}&quot;, proc_res.status),
+                &amp;format!(&quot;Error: expected failure status ({:?}) but received status {:?}.&quot;,
+                         expected_status,
+                         received_status),
                 proc_res,
             );
         }
@@ -320,7 +323,6 @@ impl&lt;'test&gt; TestCx&lt;'test&gt; {
         );

         let proc_res = self.exec_compiled_test();
-
         if !proc_res.status.success() {
             self.fatal_proc_rec(&quot;test run failed!&quot;, &amp;proc_res);
         }
@@ -499,7 +501,6 @@ impl&lt;'test&gt; TestCx&lt;'test&gt; {
                 expected,
                 actual
             );
-            panic!();
         }
     }
</code></pre>
<p>Note the use of <code>self.props.failure_status</code> to access the directive property. In
tests which do not specify the failure status directive,
<code>self.props.failure_status</code> will evaluate to the default value of 101 at the
time of this writing. But for a test which specifies a directive of, for
example, <code>//@ failure-status: 1</code>, <code>self.props.failure_status</code> will evaluate to
1, as <code>parse_failure_status()</code> will have overridden the <code>TestProps</code> default
value, for that test specifically.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../tests/ui.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../tests/minicore.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../tests/ui.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../tests/minicore.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
